
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4. Work, Energy, Momentum and Conservation laws &#8212; Classical mechanics</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1. Harmonic Oscillations" href="chapter5.html" />
    <link rel="prev" title="3. Simple Motion problems and Reminder on Newton’s Laws" href="chapter3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Classical mechanics</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   PHY321 Classical Mechanics I, Michigan State University, Spring 2021
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  About the course
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="schedule.html">
   Teaching schedule with links to material
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="teachers.html">
   Teachers and Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="textbooks.html">
   Textbooks
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introductory Material
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter1.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter2.html">
   2. Classical Mechanics, Mathematics and Numerical background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter3.html">
   3. Simple Motion problems and Reminder on Newton’s Laws
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4. Work, Energy, Momentum and Conservation laws
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Advanced Topics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter5.html">
   1. Harmonic Oscillations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter6.html">
   2. Two-body problems and Gravitational Forces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter7.html">
   3. Non-inertial Frames, Translation and Rotating Coordinate Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter8.html">
   4. Variational Calculus and Lagrangian Formalism
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chapter4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-work-energy-theorem">
   4.1. The Work-Energy Theorem
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-an-electron-moving-along-a-surface">
     4.1.1. Example of an Electron moving along a Surface
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-oscillations">
     4.1.2. Harmonic Oscillations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-integration">
   4.2. Numerical Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#newton-cotes-quadrature-or-equal-step-methods">
   4.3. Newton-Cotes Quadrature or equal-step methods
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-rectangle-method">
     4.3.1. The rectangle method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-trapezoidal-rule">
     4.3.2. The trapezoidal rule
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simpsons-rule">
     4.3.3. Simpsons’ rule
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#symbolic-integration">
     4.3.4. Symbolic integration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#energy-conservation">
   4.4. Energy Conservation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#net-energy">
     4.4.1. Net Energy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-earth-sun-system">
   4.5. The Earth-Sun system
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deriving-the-velocity-verlet-method">
     4.5.1. Deriving the Velocity-Verlet Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-material-link-between-line-integrals-and-conservative-forces">
   4.6. Additional Material: Link between Line Integrals and Conservative forces
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   4.7. Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-conservation-laws-energy-and-momentum">
     4.7.1. Exercise: Conservation laws, Energy and momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-conservation-of-angular-momentum">
     4.7.2. Exercise: Conservation of angular momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exsercise-example-of-potential">
     4.7.3. Exsercise: Example of potential
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-forces-and-potentials">
     4.7.4. Exercise: forces  and potentials
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-work-energy-theorem-and-conservation-laws">
     4.7.5. Exercise: Work-energy theorem and conservation laws
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exsercise-rocket-momentum-and-mass">
     4.7.6. Exsercise: Rocket, Momentum and mass
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-more-rockets">
     4.7.7. Exercise: More Rockets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-center-of-mass">
     4.7.8. Exercise: Center of mass
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-the-earth-sun-problem">
     4.7.9. Exercise: The Earth-Sun problem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-conservative-forces">
     4.7.10. Exercise Conservative forces
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-the-lennard-jones-potential">
     4.7.11. Exercise: The Lennard-Jones potential
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-particle-in-a-new-potential">
     4.7.12. Exercise: particle in a new potential
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-testing-energy-conservation">
     4.7.13. Exercise: Testing Energy conservation
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="work-energy-momentum-and-conservation-laws">
<h1><span class="section-number">4. </span>Work, Energy, Momentum and Conservation laws<a class="headerlink" href="#work-energy-momentum-and-conservation-laws" title="Permalink to this headline">¶</a></h1>
<p>In the previous three chapters  we have shown how to use Newton’s laws of
motion to determine the motion of an object based on the forces acting
on it. For two of the cases there is an underlying assumption that we can find an analytical solution to a continuous problem.
With a continuous problem we mean a problem where the various variables can take any value within a finite or infinite interval.</p>
<p>Unfortunately, in many cases we
cannot find an exact solution to the equations of motion we get from
Newton’s second law. The numerical approach, where we discretize the continuous problem, allows us however to study a much richer set of problems.
For problems involving Newton’s laws and the various equations of motion we encounter, solving the equations numerically, is the standard approach.</p>
<p>It allows us to focus on the underlying forces. Often we end up using the same numerical algorithm for different problems.</p>
<p>Here we introduce a commonly used technique that allows us to find the
velocity as a function of position without finding the position as a
function of time—an alternate form of Newton’s second law. The method
is based on a simple principle: Instead of solving the equations of
motion directly, we integrate the equations of motion. Such a method
is called an integration method.</p>
<p>This allows us also to introduce the <strong>work-energy</strong> theorem. This
theorem allows us to find the velocity as a function of position for
an object even in cases when we cannot solve the equations of
motion. This introduces us to the concept of work and kinetic energy,
an energy related to the motion of an object.</p>
<p>And finally, we will link the work-energy theorem with the principle of conservation of energy.</p>
<div class="section" id="the-work-energy-theorem">
<h2><span class="section-number">4.1. </span>The Work-Energy Theorem<a class="headerlink" href="#the-work-energy-theorem" title="Permalink to this headline">¶</a></h2>
<p>Let us define the kinetic energy <span class="math notranslate nohighlight">\(K\)</span> with a given velocity <span class="math notranslate nohighlight">\(\boldsymbol{v}\)</span></p>
<div class="math notranslate nohighlight">
\[
K=\frac{1}{2}mv^2,
\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the mass of the object we are considering.
We assume also that there is a force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> acting on the given object</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}=\boldsymbol{F}(\boldsymbol{r},\boldsymbol{v},t),
\]</div>
<p>with <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span> the position and <span class="math notranslate nohighlight">\(t\)</span> the time.
In general we assume the force is a function of all these variables.
Many of the more central forces in Nature however, depende only on the
position. Examples are the gravitational force and the force derived
from the Coulomb potential in electromagnetism.</p>
<p>Let us study the derivative of the kinetic energy with respect to time <span class="math notranslate nohighlight">\(t\)</span>. Its continuous form is</p>
<div class="math notranslate nohighlight">
\[
\frac{dK}{dt}=\frac{1}{2}m\frac{d\boldsymbol{v}\cdot\boldsymbol{v}}{dt}.
\]</div>
<p>Using our results from exercise 3 of homework 1, we can write the derivative of a vector dot product as</p>
<div class="math notranslate nohighlight">
\[
\frac{dK}{dt}=\frac{1}{2}m\frac{d\boldsymbol{v}\cdot\boldsymbol{v}}{dt}= \frac{1}{2}m\left(\frac{d\boldsymbol{v}}{dt}\cdot\boldsymbol{v}+\boldsymbol{v}\cdot\frac{d\boldsymbol{v}}{dt}\right)=m\frac{d\boldsymbol{v}}{dt}\cdot\boldsymbol{v}.
\]</div>
<p>We know also that the acceleration is defined as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{a}=\frac{\boldsymbol{F}}{m}=\frac{d\boldsymbol{v}}{dt}.
\]</div>
<p>We can then rewrite the equation for the derivative of the kinetic energy as</p>
<div class="math notranslate nohighlight">
\[
\frac{dK}{dt}=m\frac{d\boldsymbol{v}}{dt}\boldsymbol{v}=\boldsymbol{F}\frac{d\boldsymbol{r}}{dt},
\]</div>
<p>where we defined the velocity as the derivative of the position with respect to time.</p>
<p>Let us now discretize the above equation by letting the instantaneous terms be replaced by a discrete quantity, that is
we let <span class="math notranslate nohighlight">\(dK\rightarrow \Delta K\)</span>, <span class="math notranslate nohighlight">\(dt\rightarrow \Delta t\)</span>, <span class="math notranslate nohighlight">\(d\boldsymbol{r}\rightarrow \Delta \boldsymbol{r}\)</span> and <span class="math notranslate nohighlight">\(d\boldsymbol{v}\rightarrow \Delta \boldsymbol{v}\)</span>.</p>
<p>We have then</p>
<div class="math notranslate nohighlight">
\[
\frac{\Delta K}{\Delta t}=m\frac{\Delta \boldsymbol{v}}{\Delta t}\boldsymbol{v}=\boldsymbol{F}\frac{\Delta \boldsymbol{r}}{\Delta t},
\]</div>
<p>or by multiplying out <span class="math notranslate nohighlight">\(\Delta t\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
\Delta K=\boldsymbol{F}\Delta \boldsymbol{r}.
\]</div>
<p>We define this quantity as the <strong>work</strong> done by the force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span>
during the displacement <span class="math notranslate nohighlight">\(\Delta \boldsymbol{r}\)</span>. If we study the dimensionality
of this problem we have mass times length squared divided by time
squared, or just dimension energy.</p>
<p>If we now define a series of such displacements <span class="math notranslate nohighlight">\(\Delta\boldsymbol{r}\)</span> we have a difference in kinetic energy at a final position <span class="math notranslate nohighlight">\(\boldsymbol{r}_n\)</span> and an
initial position <span class="math notranslate nohighlight">\(\boldsymbol{r}_0\)</span> given by</p>
<div class="math notranslate nohighlight">
\[
\Delta K=\frac{1}{2}mv_n^2-\frac{1}{2}mv_0^2=\sum_{i=0}^n\boldsymbol{F}_i\Delta \boldsymbol{r},
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{F}_i\)</span> are the forces acting at every position <span class="math notranslate nohighlight">\(\boldsymbol{r}_i\)</span>.</p>
<p>The work done by acting with a force on a set of displacements can
then be as expressed as the difference between the initial and final
kinetic energies.</p>
<p>This defines the <strong>work-energy</strong> theorem.</p>
<p>If we take the limit <span class="math notranslate nohighlight">\(\Delta \boldsymbol{r}\rightarrow 0\)</span>, we can rewrite the sum over the various displacements in terms of an integral, that is</p>
<div class="math notranslate nohighlight">
\[
\Delta K=\frac{1}{2}mv_n^2-\frac{1}{2}mv_0^2=\sum_{i=0}^n\boldsymbol{F}_i\Delta \boldsymbol{r}\rightarrow \int_{\boldsymbol{r}_0}^{\boldsymbol{r}_n}\boldsymbol{F}(\boldsymbol{r},\boldsymbol{v},t)d\boldsymbol{r}.
\]</div>
<p>This integral defines a path integral since it will depend on the given path we take between the two end points. We will replace the limits with the symbol <span class="math notranslate nohighlight">\(c\)</span> in order to indicate that we take a specific countour in space when the force acts on the system. That is the work <span class="math notranslate nohighlight">\(W_{n0}\)</span> between two points <span class="math notranslate nohighlight">\(\boldsymbol{r}_n\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{r}_0\)</span> is labeled as</p>
<div class="math notranslate nohighlight">
\[
W_{n0}=\frac{1}{2}mv_n^2-\frac{1}{2}mv_0^2=\int_{c}\boldsymbol{F}(\boldsymbol{r},\boldsymbol{v},t)d\boldsymbol{r}.
\]</div>
<p>Note that if the force is perpendicular to the displacement, then the force does not affect the kinetic energy.</p>
<p>Let us now study some examples of forces and how to find the velocity from the integration over a given path.</p>
<p>Thereafter we study how to  evaluate an integral numerically.</p>
<p>In order to study the work- energy, we will normally need to perform
a numerical integration, unless we can integrate analytically. Here we
present some of the simpler  methods such as the <strong>rectangle</strong> rule, the <strong>trapezoidal</strong> rule and higher-order methods like the Simpson family of methods.</p>
<div class="section" id="example-of-an-electron-moving-along-a-surface">
<h3><span class="section-number">4.1.1. </span>Example of an Electron moving along a Surface<a class="headerlink" href="#example-of-an-electron-moving-along-a-surface" title="Permalink to this headline">¶</a></h3>
<p>As an example, let us consider the following case.
We have  classical electron which moves in the <span class="math notranslate nohighlight">\(x\)</span>-direction along a surface. The force from the surface is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(x)=-F_0\sin{(\frac{2\pi x}{b})}\boldsymbol{e}_1.
\]</div>
<p>The constant <span class="math notranslate nohighlight">\(b\)</span> represents the distance between atoms at the surface of the material, <span class="math notranslate nohighlight">\(F_0\)</span> is a constant and <span class="math notranslate nohighlight">\(x\)</span> is the position of the electron.</p>
<p>Using the work-energy theorem we can find the work <span class="math notranslate nohighlight">\(W\)</span> done when moving an electron from a position <span class="math notranslate nohighlight">\(x_0\)</span> to a final position <span class="math notranslate nohighlight">\(x\)</span> through the
integral</p>
<div class="math notranslate nohighlight">
\[
W=\int_{x_0}^x \boldsymbol{F}(x')dx' =  -\int_{x_0}^x F_0\sin{(\frac{2\pi x'}{b})} dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
W=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right].
\]</div>
<p>If we now use the work-energy theorem we can find the the velocity at a final position <span class="math notranslate nohighlight">\(x\)</span> by setting up
the differences in kinetic energies between the final position and the initial position <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<p>We have that the work done by the force is given by the difference in kinetic energies as</p>
<div class="math notranslate nohighlight">
\[
W=\frac{1}{2}m\left(v^2(x)-v^2(x_0)\right)=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right],
\]</div>
<p>and labeling <span class="math notranslate nohighlight">\(v(x_0)=v_0\)</span> (and assuming we know the initial velocity) we have</p>
<div class="math notranslate nohighlight">
\[
v(x)=\pm \sqrt{v_0^2+\frac{F_0b}{m\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right]},
\]</div>
<p>Choosing <span class="math notranslate nohighlight">\(x_0=0\)</span>m and <span class="math notranslate nohighlight">\(v_0=0\)</span>m/s we can simplify the above equation to</p>
<div class="math notranslate nohighlight">
\[
v(x)=\pm \sqrt{\frac{F_0b}{m\pi}\left[\cos{(\frac{2\pi x}{b})}-1\right]},
\]</div>
</div>
<div class="section" id="harmonic-oscillations">
<h3><span class="section-number">4.1.2. </span>Harmonic Oscillations<a class="headerlink" href="#harmonic-oscillations" title="Permalink to this headline">¶</a></h3>
<p>Another well-known force (and we will derive when we come to Harmonic
Oscillations) is the case of a sliding block attached to a wall
through a spring. The block is attached to a spring with spring
constant <span class="math notranslate nohighlight">\(k\)</span>. The other end of the spring is attached to the wall at
the origin <span class="math notranslate nohighlight">\(x=0\)</span>.  We assume the spring has an equilibrium length
<span class="math notranslate nohighlight">\(L_0\)</span>.</p>
<p>The force <span class="math notranslate nohighlight">\(F_x\)</span> from the spring on the block is then</p>
<div class="math notranslate nohighlight">
\[
F_x=-k(x-L_0).
\]</div>
<p>The position <span class="math notranslate nohighlight">\(x\)</span> where the spring force is zero is called the equilibrium position. In our case this is
<span class="math notranslate nohighlight">\(x=L_0\)</span>.</p>
<p>We can now compute the work done by this force when we move our block from an initial position <span class="math notranslate nohighlight">\(x_0\)</span> to a final position <span class="math notranslate nohighlight">\(x\)</span></p>
<div class="math notranslate nohighlight">
\[
W=\int_{x_0}^{x}F_xdx'=-k\int_{x_0}^{x}(x'-L_0)dx'=\frac{1}{2}k(x_0-L_0)^2-\frac{1}{2}k(x-L_0)^2.
\]</div>
<p>If we now bring back the definition of the work-energy theorem in terms of the kinetic energy we have</p>
<div class="math notranslate nohighlight">
\[
W=\frac{1}{2}mv^2(x)-\frac{1}{2}mv_0^2=\frac{1}{2}k(x_0-L_0)^2-\frac{1}{2}k(x-L_0)^2,
\]</div>
<p>which we rewrite as</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2}mv^2(x)+\frac{1}{2}k(x-L_0)^2=\frac{1}{2}mv_0^2+\frac{1}{2}k(x_0-L_0)^2.
\]</div>
<p>What does this mean? The total energy, which is the sum of potential and kinetic energy, is conserved.
Wow, this sounds interesting. We will analyze this next week in more detail when we study energy, momentum and angular momentum conservation.</p>
</div>
</div>
<div class="section" id="numerical-integration">
<h2><span class="section-number">4.2. </span>Numerical Integration<a class="headerlink" href="#numerical-integration" title="Permalink to this headline">¶</a></h2>
<p>Let us now see how we could have solved the above integral numerically.</p>
<p>There are several numerical algorithms for finding an integral
numerically. The more familiar ones like the rectangular rule or the
trapezoidal rule have simple geometric interpretations.</p>
<p>Let us look at the mathematical details of what are called equal-step methods, also known as Newton-Cotes quadrature.</p>
</div>
<div class="section" id="newton-cotes-quadrature-or-equal-step-methods">
<h2><span class="section-number">4.3. </span>Newton-Cotes Quadrature or equal-step methods<a class="headerlink" href="#newton-cotes-quadrature-or-equal-step-methods" title="Permalink to this headline">¶</a></h2>
<p>The integral</p>
<!-- Equation labels as ordinary links -->
<div id="eq:integraldef"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx
\label{eq:integraldef} \tag{1}
\end{equation}
\]</div>
<p>has a very simple meaning. The integral is the
area enscribed by the function <span class="math notranslate nohighlight">\(f(x)\)</span> starting from <span class="math notranslate nohighlight">\(x=a\)</span> to  <span class="math notranslate nohighlight">\(x=b\)</span>. It is subdivided in several smaller areas whose evaluation is to  be approximated by different techniques. The areas under the curve can for example  be approximated by rectangular boxes or trapezoids.</p>
<p>In considering equal step  methods, our basic approach is that of approximating
a function <span class="math notranslate nohighlight">\(f(x)\)</span> with a polynomial of at most
degree <span class="math notranslate nohighlight">\(N-1\)</span>, given <span class="math notranslate nohighlight">\(N\)</span> integration points. If our polynomial is of degree <span class="math notranslate nohighlight">\(1\)</span>,
the function will be approximated with <span class="math notranslate nohighlight">\(f(x)\approx a_0+a_1x\)</span>.</p>
<p>The algorithm for these integration methods  is rather simple, and the number of approximations perhaps  unlimited!</p>
<ul class="simple">
<li><p>Choose a step size <span class="math notranslate nohighlight">\(h=(b-a)/N\)</span>  where <span class="math notranslate nohighlight">\(N\)</span> is the number of steps and <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> the lower and upper limits of integration.</p></li>
<li><p>With a given step length we rewrite the integral as</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x) dx= \int_a^{a+h}f(x)dx + \int_{a+h}^{a+2h}f(x)dx+\dots \int_{b-h}^{b}f(x)dx.
\]</div>
<ul class="simple">
<li><p>The strategy then is to find a reliable polynomial approximation   for <span class="math notranslate nohighlight">\(f(x)\)</span> in the various intervals.  Choosing a given approximation for  <span class="math notranslate nohighlight">\(f(x)\)</span>, we obtain a specific approximation to the  integral.</p></li>
<li><p>With this approximation to <span class="math notranslate nohighlight">\(f(x)\)</span> we perform the integration by computing the integrals over all subintervals.</p></li>
</ul>
<p>One possible strategy then is to find a reliable polynomial expansion for <span class="math notranslate nohighlight">\(f(x)\)</span> in the smaller
subintervals. Consider for example evaluating</p>
<div class="math notranslate nohighlight">
\[
\int_a^{a+2h}f(x)dx,
\]</div>
<p>which we rewrite as</p>
<!-- Equation labels as ordinary links -->
<div id="eq:hhint"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\int_a^{a+2h}f(x)dx=\int_{x_0-h}^{x_0+h}f(x)dx.
\label{eq:hhint} \tag{2}
\end{equation}
\]</div>
<p>We have chosen a midpoint <span class="math notranslate nohighlight">\(x_0\)</span> and have defined <span class="math notranslate nohighlight">\(x_0=a+h\)</span>.</p>
<div class="section" id="the-rectangle-method">
<h3><span class="section-number">4.3.1. </span>The rectangle method<a class="headerlink" href="#the-rectangle-method" title="Permalink to this headline">¶</a></h3>
<p>A very simple approach is the so-called midpoint or rectangle method.
In this case the integration area is split in a given number of rectangles with length <span class="math notranslate nohighlight">\(h\)</span> and height given by the mid-point value of the function.  This gives the following simple rule for approximating an integral</p>
<!-- Equation labels as ordinary links -->
<div id="eq:rectangle"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
I=\int_a^bf(x) dx \approx  h\sum_{i=1}^N f(x_{i-1/2}), 
\label{eq:rectangle} \tag{3}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(f(x_{i-1/2})\)</span> is the midpoint value of <span class="math notranslate nohighlight">\(f\)</span> for a given rectangle. We will discuss its truncation
error below.  It is easy to implement this algorithm,  as shown below</p>
<p>The correct mathematical expression for the local error for the rectangular rule <span class="math notranslate nohighlight">\(R_i(h)\)</span> for element <span class="math notranslate nohighlight">\(i\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\int_{-h}^hf(x)dx - R_i(h)=-\frac{h^3}{24}f^{(2)}(\xi),
\]</div>
<p>and the global error reads</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -R_h(f)=-\frac{b-a}{24}h^2f^{(2)}(\xi),
\]</div>
<p>where <span class="math notranslate nohighlight">\(R_h\)</span> is the result obtained with rectangular rule and <span class="math notranslate nohighlight">\(\xi \in [a,b]\)</span>.</p>
<p>We go back to our simple example above and set <span class="math notranslate nohighlight">\(F_0=b=1\)</span> and choose <span class="math notranslate nohighlight">\(x_0=0\)</span> and <span class="math notranslate nohighlight">\(x=1/2\)</span>, and have</p>
<div class="math notranslate nohighlight">
\[
W=\frac{1}{\pi}.
\]</div>
<p>The code here computes the integral using the rectangle rule and <span class="math notranslate nohighlight">\(n=100\)</span> integration points we have a relative error of
<span class="math notranslate nohighlight">\(10^{-5}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the Rectangular rule                                                                                        </span>
<span class="k">def</span> <span class="nf">Rectangular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
       <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">h</span>
       <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span>
<span class="c1"># function to integrate</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Rectangular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  4.112453549290521e-05
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-trapezoidal-rule">
<h3><span class="section-number">4.3.2. </span>The trapezoidal rule<a class="headerlink" href="#the-trapezoidal-rule" title="Permalink to this headline">¶</a></h3>
<p>The other integral gives</p>
<div class="math notranslate nohighlight">
\[
\int_{x_0-h}^{x_0}f(x)dx=\frac{h}{2}\left(f(x_0) + f(x_0-h)\right)+O(h^3),
\]</div>
<p>and adding up we obtain</p>
<!-- Equation labels as ordinary links -->
<div id="eq:trapez"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   \int_{x_0-h}^{x_0+h}f(x)dx=\frac{h}{2}\left(f(x_0+h) + 2f(x_0) + f(x_0-h)\right)+O(h^3),
\label{eq:trapez} \tag{4}
\end{equation}
\]</div>
<p>which is the well-known trapezoidal rule.  Concerning the error in the approximation made,
<span class="math notranslate nohighlight">\(O(h^3)=O((b-a)^3/N^3)\)</span>, you should  note
that this is the local error.  Since we are splitting the integral from
<span class="math notranslate nohighlight">\(a\)</span> to <span class="math notranslate nohighlight">\(b\)</span> in <span class="math notranslate nohighlight">\(N\)</span> pieces, we will have to perform approximately <span class="math notranslate nohighlight">\(N\)</span>
such operations.</p>
<p>This means that the <em>global error</em> goes like <span class="math notranslate nohighlight">\(\approx O(h^2)\)</span>.
The trapezoidal reads then</p>
<!-- Equation labels as ordinary links -->
<div id="eq:trapez1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx=h\left(f(a)/2 + f(a+h) +f(a+2h)+
                          \dots +f(b-h)+ f_{b}/2\right),
\label{eq:trapez1} \tag{5}
\end{equation}
\]</div>
<p>with a global error which goes like <span class="math notranslate nohighlight">\(O(h^2)\)</span>.</p>
<p>Hereafter we use the shorthand notations <span class="math notranslate nohighlight">\(f_{-h}=f(x_0-h)\)</span>, <span class="math notranslate nohighlight">\(f_{0}=f(x_0)\)</span>
and <span class="math notranslate nohighlight">\(f_{h}=f(x_0+h)\)</span>.</p>
<p>The correct mathematical expression for the local error for the trapezoidal rule is</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -\frac{b-a}{2}\left[f(a)+f(b)\right]=-\frac{h^3}{12}f^{(2)}(\xi),
\]</div>
<p>and the global error reads</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -T_h(f)=-\frac{b-a}{12}h^2f^{(2)}(\xi),
\]</div>
<p>where <span class="math notranslate nohighlight">\(T_h\)</span> is the trapezoidal result and <span class="math notranslate nohighlight">\(\xi \in [a,b]\)</span>.</p>
<p>The trapezoidal rule is easy to  implement numerically
through the following simple algorithm</p>
<ul class="simple">
<li><p>Choose the number of mesh points and fix the step length.</p></li>
<li><p>calculate <span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> and multiply with <span class="math notranslate nohighlight">\(h/2\)</span>.</p></li>
<li><p>Perform a loop over <span class="math notranslate nohighlight">\(n=1\)</span> to <span class="math notranslate nohighlight">\(n-1\)</span> (<span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> are known) and sum up  the terms <span class="math notranslate nohighlight">\(f(a+h) +f(a+2h)+f(a+3h)+\dots +f(b-h)\)</span>. Each step in the loop  corresponds to a given value <span class="math notranslate nohighlight">\(a+nh\)</span>.</p></li>
<li><p>Multiply the final result by <span class="math notranslate nohighlight">\(h\)</span> and add <span class="math notranslate nohighlight">\(hf(a)/2\)</span> and <span class="math notranslate nohighlight">\(hf(b)/2\)</span>.</p></li>
</ul>
<p>We use the same function and integrate now using the trapoezoidal rule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the trapezoidal rule</span>
<span class="k">def</span> <span class="nf">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">a</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
       <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">h</span>
       <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span><span class="n">s</span>
   <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span>
<span class="c1"># function to integrate</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  8.224805627923717e-05
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="simpsons-rule">
<h3><span class="section-number">4.3.3. </span>Simpsons’ rule<a class="headerlink" href="#simpsons-rule" title="Permalink to this headline">¶</a></h3>
<p>Instead of using the above first-order polynomials
approximations for <span class="math notranslate nohighlight">\(f\)</span>, we attempt at using a second-order polynomials.
In this case we need three points in order to define a second-order
polynomial approximation</p>
<div class="math notranslate nohighlight">
\[
f(x) \approx P_2(x)=a_0+a_1x+a_2x^2.
\]</div>
<p>Using again Lagrange’s interpolation formula we have</p>
<div class="math notranslate nohighlight">
\[
P_2(x)=\frac{(x-x_0)(x-x_1)}{(x_2-x_0)(x_2-x_1)}y_2+
            \frac{(x-x_0)(x-x_2)}{(x_1-x_0)(x_1-x_2)}y_1+
            \frac{(x-x_1)(x-x_2)}{(x_0-x_1)(x_0-x_2)}y_0.
\]</div>
<p>Inserting this formula in the integral of Eq.  (<a class="reference external" href="#eq:hhint">2</a>) we obtain</p>
<div class="math notranslate nohighlight">
\[
\int_{-h}^{+h}f(x)dx=\frac{h}{3}\left(f_h + 4f_0 + f_{-h}\right)+O(h^5),
\]</div>
<p>which is Simpson’s rule.</p>
<p>Note that the improved accuracy in the evaluation of
the derivatives gives a better error approximation, <span class="math notranslate nohighlight">\(O(h^5)\)</span> vs.\ <span class="math notranslate nohighlight">\(O(h^3)\)</span> .
But this is again the <em>local error approximation</em>.
Using Simpson’s rule we can easily compute
the integral     of Eq.  (<a class="reference external" href="#eq:integraldef">1</a>) to be</p>
<!-- Equation labels as ordinary links -->
<div id="eq:simpson"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   I=\int_a^bf(x) dx=\frac{h}{3}\left(f(a) + 4f(a+h) +2f(a+2h)+
                          \dots +4f(b-h)+ f_{b}\right),
\label{eq:simpson} \tag{6}
\end{equation}
\]</div>
<p>with a global error which goes like <span class="math notranslate nohighlight">\(O(h^4)\)</span>.</p>
<p>More formal expressions for the local and global errors are for the local error</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -\frac{b-a}{6}\left[f(a)+4f((a+b)/2)+f(b)\right]=-\frac{h^5}{90}f^{(4)}(\xi),
\]</div>
<p>and for the global error</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx -S_h(f)=-\frac{b-a}{180}h^4f^{(4)}(\xi).
\]</div>
<p>with <span class="math notranslate nohighlight">\(\xi\in[a,b]\)</span> and <span class="math notranslate nohighlight">\(S_h\)</span> the results obtained with Simpson’s method.</p>
<p>The method
can easily be implemented numerically through the following simple algorithm</p>
<ul class="simple">
<li><p>Choose the number of mesh points and fix the step.</p></li>
<li><p>calculate <span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span></p></li>
<li><p>Perform a loop over <span class="math notranslate nohighlight">\(n=1\)</span> to <span class="math notranslate nohighlight">\(n-1\)</span> (<span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(b)\)</span> are known) and sum up   the terms <span class="math notranslate nohighlight">\(4f(a+h) +2f(a+2h)+4f(a+3h)+\dots +4f(b-h)\)</span>. Each step in the loop  corresponds to a given value <span class="math notranslate nohighlight">\(a+nh\)</span>. Odd values of <span class="math notranslate nohighlight">\(n\)</span> give <span class="math notranslate nohighlight">\(4\)</span> as factor  while even values yield <span class="math notranslate nohighlight">\(2\)</span> as factor.</p></li>
<li><p>Multiply the final result by <span class="math notranslate nohighlight">\(\frac{h}{3}\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="c1"># function for the trapezoidal rule                                                                                        </span>
<span class="k">def</span> <span class="nf">Simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="nb">sum</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
       <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
   <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">sum</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mf">3.0</span>
<span class="c1"># function to integrate                                                                                                    </span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># define integration limits and integration points                                                                         </span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Exact</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Relative error= &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">Simpson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">Exact</span><span class="p">)</span><span class="o">/</span><span class="n">Exact</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Relative error=  5.412252157986472e-09
</pre></div>
</div>
</div>
</div>
<p>We see that Simpson’s rule gives a much better estimation of the relative error with the same amount of points as we had for the Rectangle rule and the Trapezoidal rule.</p>
</div>
<div class="section" id="symbolic-integration">
<h3><span class="section-number">4.3.4. </span>Symbolic integration<a class="headerlink" href="#symbolic-integration" title="Permalink to this headline">¶</a></h3>
<p>We could also use the symbolic mathematics. Here Python comes to our rescue with <a class="reference external" href="https://www.sympy.org/en/index.html">SymPy</a>, which is a Python library for symbolic mathematics.</p>
<p>Here’s an example on how you could use <strong>Sympy</strong> where we compare the symbolic calculation with an
integration of a function <span class="math notranslate nohighlight">\(f(x)\)</span> by the Trapezoidal rule.
Here we show an
example code that evaluates  the integral
<span class="math notranslate nohighlight">\(\int_0^1 dx x^2 = 1/3\)</span>.
The following code for  the trapezoidal rule allows you  to plot the relative error by comparing with the exact result. By increasing to <span class="math notranslate nohighlight">\(10^8\)</span> points one arrives at a region where numerical errors start to accumulate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log10</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">integrate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># function for the trapezoidal rule</span>
<span class="k">def</span> <span class="nf">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
   <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">a</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
       <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">h</span>
       <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span><span class="n">s</span>
   <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span>
<span class="c1">#  function to compute pi</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
<span class="c1"># define integration limits</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>  <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="c1"># find result from sympy</span>
<span class="c1"># define x as a symbol to be used by sympy</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">exact</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="c1"># set up the arrays for plotting the relative error</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
<span class="c1"># find the relative error as function of integration points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">i</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Trapez</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">npts</span><span class="p">)</span>
    <span class="n">RelativeError</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">exact</span><span class="o">-</span><span class="n">result</span><span class="p">)</span><span class="o">/</span><span class="n">exact</span><span class="p">)</span>
    <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span><span class="n">npts</span><span class="p">);</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span><span class="n">RelativeError</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_87_0.png" src="_images/chapter4_87_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="energy-conservation">
<h2><span class="section-number">4.4. </span>Energy Conservation<a class="headerlink" href="#energy-conservation" title="Permalink to this headline">¶</a></h2>
<p>Energy conservation is most convenient as a strategy for addressing
problems where time does not appear. For example, a particle goes
from position <span class="math notranslate nohighlight">\(x_0\)</span> with speed <span class="math notranslate nohighlight">\(v_0\)</span>, to position <span class="math notranslate nohighlight">\(x_f\)</span>; what is its
new speed? However, it can also be applied to problems where time
does appear, such as in solving for the trajectory <span class="math notranslate nohighlight">\(x(t)\)</span>, or
equivalently <span class="math notranslate nohighlight">\(t(x)\)</span>.</p>
<p>Energy is conserved in the case where the potential energy, <span class="math notranslate nohighlight">\(V(\boldsymbol{r})\)</span>, depends only on position, and not on time. The force is determined by <span class="math notranslate nohighlight">\(V\)</span>,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto1"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\boldsymbol{F}(\boldsymbol{r})=-\boldsymbol{\nabla} V(\boldsymbol{r}).
\label{_auto1} \tag{7}
\end{equation}
\]</div>
<p>We say a force is conservative if it satisfies the following conditions:</p>
<ol class="simple">
<li><p>The force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> acting on an object only depends on the position <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span>, that is <span class="math notranslate nohighlight">\(\boldsymbol{F}=\boldsymbol{F}(\boldsymbol{r})\)</span>.</p></li>
<li><p>For any two points <span class="math notranslate nohighlight">\(\boldsymbol{r}_1\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{r}_2\)</span>, the work done by the force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> on the displacement between these two points is independent of the path taken.</p></li>
<li><p>Finally, the <strong>curl</strong> of the force is zero <span class="math notranslate nohighlight">\(\boldsymbol{\nabla}\times\boldsymbol{F}=0\)</span>.</p></li>
</ol>
<p>The energy <span class="math notranslate nohighlight">\(E\)</span> of a given system is defined as the sum of kinetic and potential energies,</p>
<div class="math notranslate nohighlight">
\[
E=K+V(\boldsymbol{r}).
\]</div>
<p>We define the potential energy at a point <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span> as the negative work done from a starting point <span class="math notranslate nohighlight">\(\boldsymbol{r}_0\)</span> to a final point <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span></p>
<div class="math notranslate nohighlight">
\[
V(\boldsymbol{r})=-W(\boldsymbol{r}_0\rightarrow\boldsymbol{r})= -\int_{\boldsymbol{r}_0}^{\boldsymbol{r}}d\boldsymbol{r}'\boldsymbol{F}(\boldsymbol{r}').
\]</div>
<p>If the potential depends on the path taken between these two points there is no unique potential.</p>
<p>As an example, let
us study a classical electron which moves in the <span class="math notranslate nohighlight">\(x\)</span>-direction along a surface. The force from the surface is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(x)=-F_0\sin{(\frac{2\pi x}{b})}\boldsymbol{e}_1.
\]</div>
<p>The constant <span class="math notranslate nohighlight">\(b\)</span> represents the distance between atoms at the surface of the material, <span class="math notranslate nohighlight">\(F_0\)</span> is a constant and <span class="math notranslate nohighlight">\(x\)</span> is the position of the electron.</p>
<p>This is indeed a conservative force since it depends only on position
and its <strong>curl</strong> is zero, that is <span class="math notranslate nohighlight">\(-\boldsymbol{\nabla}\times \boldsymbol{F}=0\)</span>. This means that energy is conserved and the
integral over the work done by the force is independent of the path
taken.</p>
<p>Using the work-energy theorem we can find the work <span class="math notranslate nohighlight">\(W\)</span> done when
moving an electron from a position <span class="math notranslate nohighlight">\(x_0\)</span> to a final position <span class="math notranslate nohighlight">\(x\)</span>
through the integral</p>
<div class="math notranslate nohighlight">
\[
W=\int_{x_0}^x \boldsymbol{F}(x')dx' =  -\int_{x_0}^x F_0\sin{(\frac{2\pi x'}{b})} dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
W=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right].
\]</div>
<p>Since this is related to the change in kinetic energy we have, with <span class="math notranslate nohighlight">\(v_0\)</span> being the initial velocity at a  time <span class="math notranslate nohighlight">\(t_0\)</span>,</p>
<div class="math notranslate nohighlight">
\[
v  = \pm\sqrt{\frac{2}{m}\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right]+v_0^2}.
\]</div>
<p>The potential energy, due to energy conservation is</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)+\frac{1}{2}mv_0^2-\frac{1}{2}mv^2,
\]</div>
<p>with <span class="math notranslate nohighlight">\(v\)</span> given by the velocity from above.</p>
<p>We can now, in order to find a more explicit expression for the
potential energy at a given value <span class="math notranslate nohighlight">\(x\)</span>, define a zero level value for
the potential. The potential is defined, using the work-energy
theorem, as</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)+\int_{x_0}^x (-F(x'))dx',
\]</div>
<p>and if you recall the definition of the indefinite integral, we can rewrite this as</p>
<div class="math notranslate nohighlight">
\[
V(x)=\int (-F(x'))dx'+C,
\]</div>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is an undefined constant. The force is defined as the
gradient of the potential, and in that case the undefined constant
vanishes. The constant does not affect the force we derive from the
potential.</p>
<p>We have then</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)-\int_{x_0}^x \boldsymbol{F}(x')dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
V(x)=-\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right]+V(x_0).
\]</div>
<p>We can now define</p>
<div class="math notranslate nohighlight">
\[
-\frac{F_0b}{2\pi}\cos{(\frac{2\pi x_0}{b})}=V(x_0),
\]</div>
<p>which gives</p>
<div class="math notranslate nohighlight">
\[
V(x)=-\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}\right].
\]</div>
<p>We have defined work as the energy resulting from a net force acting
on an object (or sseveral objects), that is</p>
<div class="math notranslate nohighlight">
\[
W(\boldsymbol{r}\rightarrow \boldsymbol{r}+d\boldsymbol{r})= \boldsymbol{F}(\boldsymbol{r})d\boldsymbol{r}.
\]</div>
<p>If we write out this for each component we have</p>
<div class="math notranslate nohighlight">
\[
W(\boldsymbol{r}\rightarrow \boldsymbol{r}+d\boldsymbol{r})=\boldsymbol{F}(\boldsymbol{r})d\boldsymbol{r}=F_xdx+F_ydy+F_zdz.
\]</div>
<p>The work done from an initial position to a final one defines also the difference in potential energies</p>
<div class="math notranslate nohighlight">
\[
W(\boldsymbol{r}\rightarrow \boldsymbol{r}+d\boldsymbol{r})=-\left[V(\boldsymbol{r}+d\boldsymbol{r})-V(\boldsymbol{r})\right].
\]</div>
<p>We can write out the differences in potential energies as</p>
<div class="math notranslate nohighlight">
\[
V(\boldsymbol{r}+d\boldsymbol{r})-V(\boldsymbol{r})=V(x+dx,y+dy,z+dz)-V(x,y,z)=dV,
\]</div>
<p>and using the expression the differential of a multi-variable function <span class="math notranslate nohighlight">\(f(x,y,z)\)</span></p>
<div class="math notranslate nohighlight">
\[
df=\frac{\partial f}{\partial x}dx+\frac{\partial f}{\partial y}dy+\frac{\partial f}{\partial z}dz,
\]</div>
<p>we can write the expression for the work done as</p>
<div class="math notranslate nohighlight">
\[
W(\boldsymbol{r}\rightarrow \boldsymbol{r}+d\boldsymbol{r})=-dV=-\left[\frac{\partial V}{\partial x}dx+\frac{\partial V}{\partial y}dy+\frac{\partial V}{\partial z}dz \right].
\]</div>
<p>Comparing the last equation with</p>
<div class="math notranslate nohighlight">
\[
W(\boldsymbol{r}\rightarrow \boldsymbol{r}+d\boldsymbol{r})=F_xdx+F_ydy+F_zdz,
\]</div>
<p>we have</p>
<div class="math notranslate nohighlight">
\[
F_xdx+F_ydy+F_zdz=-\left[\frac{\partial V}{\partial x}dx+\frac{\partial V}{\partial y}dy+\frac{\partial V}{\partial z}dz \right],
\]</div>
<p>leading to</p>
<div class="math notranslate nohighlight">
\[
F_x=-\frac{\partial V}{\partial x},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_y=-\frac{\partial V}{\partial y},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_z=-\frac{\partial V}{\partial z},
\]</div>
<p>or just</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}=-\frac{\partial V}{\partial x}\boldsymbol{e}_1-\frac{\partial V}{\partial y}\boldsymbol{e}_2-\frac{\partial V}{\partial z}\boldsymbol{e}_3=-\boldsymbol{\nabla}V(\boldsymbol{r}).
\]</div>
<p>And this connection is the one we wanted to show.</p>
<div class="section" id="net-energy">
<h3><span class="section-number">4.4.1. </span>Net Energy<a class="headerlink" href="#net-energy" title="Permalink to this headline">¶</a></h3>
<p>The net energy, <span class="math notranslate nohighlight">\(E=V+K\)</span> where <span class="math notranslate nohighlight">\(K\)</span> is the kinetic energy, is then conserved,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}(K+V)&amp;=&amp;\frac{d}{dt}\left(\frac{m}{2}(v_x^2+v_y^2+v_z^2)+V(\boldsymbol{r})\right)\\
\nonumber
&amp;=&amp;m\left(v_x\frac{dv_x}{dt}+v_y\frac{dv_y}{dt}+v_z\frac{dv_z}{dt}\right)
+\partial_xV\frac{dx}{dt}+\partial_yV\frac{dy}{dt}+\partial_zV\frac{dz}{dt}\\
\nonumber
&amp;=&amp;v_xF_x+v_yF_y+v_zF_z-F_xv_x-F_yv_y-F_zv_z=0.
\end{eqnarray}
\end{split}\]</div>
<p>The same proof can be written more compactly with vector notation,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\left(\frac{m}{2}v^2+V(\boldsymbol{r})\right)
&amp;=&amp;m\boldsymbol{v}\cdot\dot{\boldsymbol{v}}+\boldsymbol{\nabla} V(\boldsymbol{r})\cdot\dot{\boldsymbol{r}}\\
\nonumber
&amp;=&amp;\boldsymbol{v}\cdot\boldsymbol{F}-\boldsymbol{F}\cdot\boldsymbol{v}=0.
\end{eqnarray}
\end{split}\]</div>
<p>Inverting the expression for kinetic energy,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto2"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
v=\sqrt{2K/m}=\sqrt{2(E-V)/m},
\label{_auto2} \tag{8}
\end{equation}
\]</div>
<p>allows one to solve for the one-dimensional trajectory <span class="math notranslate nohighlight">\(x(t)\)</span>, by finding <span class="math notranslate nohighlight">\(t(x)\)</span>,</p>
<!-- Equation labels as ordinary links -->
<div id="_auto3"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
t=\int_{x_0}^x \frac{dx'}{v(x')}=\int_{x_0}^x\frac{dx'}{\sqrt{2(E-V(x'))/m}}.
\label{_auto3} \tag{9}
\end{equation}
\]</div>
<p>Note this would be much more difficult in higher dimensions, because
you would have to determine which points, <span class="math notranslate nohighlight">\(x,y,z\)</span>, the particles might
reach in the trajectory, whereas in one dimension you can typically
tell by simply seeing whether the kinetic energy is positive at every
point between the old position and the new position.</p>
</div>
</div>
<div class="section" id="the-earth-sun-system">
<h2><span class="section-number">4.5. </span>The Earth-Sun system<a class="headerlink" href="#the-earth-sun-system" title="Permalink to this headline">¶</a></h2>
<p>We will now venture into a study of a system which is energy
conserving. The aim is to see if we (since it is not possible to solve
the general equations analytically) we can develop stable numerical
algorithms whose results we can trust!</p>
<p>We solve the equations of motion numerically. We will also compute
quantities like the energy numerically.</p>
<p>We start with a simpler case first, the Earth-Sun system  in two dimensions only.  The gravitational force <span class="math notranslate nohighlight">\(F_G\)</span> on the earth from the sun is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}_G=-\frac{GM_{\odot}M_E}{r^3}\boldsymbol{r},
\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the gravitational constant,</p>
<div class="math notranslate nohighlight">
\[
M_E=6\times 10^{24}\mathrm{Kg},
\]</div>
<p>the mass of Earth,</p>
<div class="math notranslate nohighlight">
\[
M_{\odot}=2\times 10^{30}\mathrm{Kg},
\]</div>
<p>the mass of the Sun and</p>
<div class="math notranslate nohighlight">
\[
r=1.5\times 10^{11}\mathrm{m},
\]</div>
<p>is the distance between Earth and the Sun. The latter defines what we call an astronomical unit <strong>AU</strong>.</p>
<p>From Newton’s second law we have then for the <span class="math notranslate nohighlight">\(x\)</span> direction</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2x}{dt^2}=-\frac{F_{x}}{M_E},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2y}{dt^2}=-\frac{F_{y}}{M_E},
\]</div>
<p>for the <span class="math notranslate nohighlight">\(y\)</span> direction.</p>
<p>Here we will use  that  <span class="math notranslate nohighlight">\(x=r\cos{(\theta)}\)</span>, <span class="math notranslate nohighlight">\(y=r\sin{(\theta)}\)</span> and</p>
<div class="math notranslate nohighlight">
\[
r = \sqrt{x^2+y^2}.
\]</div>
<p>We can rewrite</p>
<div class="math notranslate nohighlight">
\[
F_{x}=-\frac{GM_{\odot}M_E}{r^2}\cos{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_{y}=-\frac{GM_{\odot}M_E}{r^2}\sin{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}y,
\]</div>
<p>for the <span class="math notranslate nohighlight">\(y\)</span> direction.</p>
<p>We can rewrite these two equations</p>
<div class="math notranslate nohighlight">
\[
F_{x}=-\frac{GM_{\odot}M_E}{r^2}\cos{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_{y}=-\frac{GM_{\odot}M_E}{r^2}\sin{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}y,
\]</div>
<p>as four first-order coupled differential equations</p>
<p>8
1</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>8
2</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>8
3</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y.
\]</div>
<p>The four coupled differential equations</p>
<p>8
5</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>8
6</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>8
7</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y,
\]</div>
<p>can be turned into dimensionless equations or we can introduce astronomical units with <span class="math notranslate nohighlight">\(1\)</span> AU = <span class="math notranslate nohighlight">\(1.5\times 10^{11}\)</span>.</p>
<p>Using the equations from circular motion (with <span class="math notranslate nohighlight">\(r =1\mathrm{AU}\)</span>)</p>
<div class="math notranslate nohighlight">
\[
\frac{M_E v^2}{r} = F = \frac{GM_{\odot}M_E}{r^2},
\]</div>
<p>we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}=v^2r,
\]</div>
<p>and using that the velocity of Earth (assuming circular motion) is
<span class="math notranslate nohighlight">\(v = 2\pi r/\mathrm{yr}=2\pi\mathrm{AU}/\mathrm{yr}\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}= v^2r = 4\pi^2 \frac{(\mathrm{AU})^3}{\mathrm{yr}^2}.
\]</div>
<p>The four coupled differential equations can then be discretized using Euler’s method as (with step length <span class="math notranslate nohighlight">\(h\)</span>)</p>
<p>9
2</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>9
3</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<p>9
4</p>
<p>&lt;
&lt;
&lt;
!
!
M
A
T
H
_
B
L
O
C
K</p>
<div class="math notranslate nohighlight">
\[
y_{i+1}=y_i+hv_{y,i},
\]</div>
<p>The code here implements Euler’s method for the Earth-Sun system using a more compact way of representing the vectors. Alternatively, you could have spelled out all the variables <span class="math notranslate nohighlight">\(v_x\)</span>, <span class="math notranslate nohighlight">\(v_y\)</span>, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> as one-dimensional arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Where to save the figures and data files</span>
<span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;Results&quot;</span>
<span class="n">FIGURE_ID</span> <span class="o">=</span> <span class="s2">&quot;Results/FigureFiles&quot;</span>
<span class="n">DATA_ID</span> <span class="o">=</span> <span class="s2">&quot;DataFiles/&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="n">dat_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">,</span> <span class="n">dat_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>


<span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using Euler&#39;s method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up the acceleration</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using Euler&#39;s forward method</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">a</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.set_xlim(0, tfinal)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunEuler&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_192_0.png" src="_images/chapter4_192_0.png" />
</div>
</div>
<p>We notice here that Euler’s method doesn’t give a stable orbit. It
means that we cannot trust Euler’s method. In a deeper way, as we will
see in homework 5, Euler’s method does not conserve energy. It is an
example of an integrator which is not
<a class="reference external" href="https://en.wikipedia.org/wiki/Symplectic_integrator">symplectic</a>.</p>
<p>Here we present thus two methods, which with simple changes allow us to avoid these pitfalls. The simplest possible extension is the so-called Euler-Cromer method.
The changes we need to make to our code are indeed marginal here.
We need simply to replace</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>in the above code with the velocity at the new time <span class="math notranslate nohighlight">\(t_{i+1}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>By this simple caveat we get stable orbits.
Below we derive the Euler-Cromer method as well as one of the most utlized algorithms for sovling the above type of problems, the so-called Velocity-Verlet method.</p>
<p>Let us repeat Euler’s method.
We have a differential equation</p>
<!-- Equation labels as ordinary links -->
<div id="_auto4"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
y'(t_i)=f(t_i,y_i)   
\label{_auto4} \tag{10}
\end{equation}
\]</div>
<p>and if we truncate at the first derivative, we have from the Taylor expansion</p>
<!-- Equation labels as ordinary links -->
<div id="eq:euler"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
y_{i+1}=y(t_i) + (\Delta t) f(t_i,y_i) + O(\Delta t^2), \label{eq:euler} \tag{11}
\end{equation}
\]</div>
<p>which when complemented with <span class="math notranslate nohighlight">\(t_{i+1}=t_i+\Delta t\)</span> forms
the algorithm for the well-known Euler method.
Note that at every step we make an approximation error
of the order of <span class="math notranslate nohighlight">\(O(\Delta t^2)\)</span>, however the total error is the sum over all
steps <span class="math notranslate nohighlight">\(N=(b-a)/(\Delta t)\)</span> for <span class="math notranslate nohighlight">\(t\in [a,b]\)</span>, yielding thus a global error which goes like
<span class="math notranslate nohighlight">\(NO(\Delta t^2)\approx O(\Delta t)\)</span>.</p>
<p>To make Euler’s method more precise we can obviously
decrease <span class="math notranslate nohighlight">\(\Delta t\)</span> (increase <span class="math notranslate nohighlight">\(N\)</span>), but this can lead to loss of numerical precision.
Euler’s method is not recommended for precision calculation,
although it is handy to use in order to get a first
view on how a solution may look like.</p>
<p>Euler’s method is asymmetric in time, since it uses information about the derivative at the beginning
of the time interval. This means that we evaluate the position at <span class="math notranslate nohighlight">\(y_1\)</span> using the velocity
at <span class="math notranslate nohighlight">\(v_0\)</span>. A simple variation is to determine <span class="math notranslate nohighlight">\(x_{n+1}\)</span> using the velocity at
<span class="math notranslate nohighlight">\(v_{n+1}\)</span>, that is (in a slightly more generalized form)</p>
<!-- Equation labels as ordinary links -->
<div id="_auto5"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation} 
y_{n+1}=y_{n}+ v_{n+1}+O(\Delta t^2)
\label{_auto5} \tag{12}
\end{equation}
\]</div>
<p>and</p>
<!-- Equation labels as ordinary links -->
<div id="_auto6"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
v_{n+1}=v_{n}+(\Delta t) a_{n}+O(\Delta t^2).
\label{_auto6} \tag{13}
\end{equation}
\]</div>
<p>The acceleration <span class="math notranslate nohighlight">\(a_n\)</span> is a function of <span class="math notranslate nohighlight">\(a_n(y_n, v_n, t_n)\)</span> and needs to be evaluated
as well. This is the Euler-Cromer method.</p>
<div class="section" id="deriving-the-velocity-verlet-method">
<h3><span class="section-number">4.5.1. </span>Deriving the Velocity-Verlet Method<a class="headerlink" href="#deriving-the-velocity-verlet-method" title="Permalink to this headline">¶</a></h3>
<p>Let us stay with <span class="math notranslate nohighlight">\(x\)</span> (position) and <span class="math notranslate nohighlight">\(v\)</span> (velocity) as the quantities we are interested in.</p>
<p>We have the Taylor expansion for the position given by</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_i+O((\Delta t)^3).
\]</div>
<p>The corresponding expansion for the velocity is</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+(\Delta t)a_i+\frac{(\Delta t)^2}{2}v^{(2)}_i+O((\Delta t)^3).
\]</div>
<p>Via Newton’s second law we have normally an analytical expression for the derivative of the velocity, namely</p>
<div class="math notranslate nohighlight">
\[
a_i= \frac{d^2 x}{dt^2}\vert_{i}=\frac{d v}{dt}\vert_{i}= \frac{F(x_i,v_i,t_i)}{m}.
\]</div>
<p>If we add to this the corresponding expansion for the derivative of the velocity</p>
<div class="math notranslate nohighlight">
\[
v^{(1)}_{i+1} = a_{i+1}= a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2)=a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2),
\]</div>
<p>and retain only terms up to the second derivative of the velocity since our error goes as <span class="math notranslate nohighlight">\(O(h^3)\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
(\Delta t)v^{(2)}_i\approx a_{i+1}-a_i.
\]</div>
<p>We can then rewrite the Taylor expansion for the velocity as</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left( a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Our final equations for the position and the velocity become then</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_{i}+O((\Delta t)^3),
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left(a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Note well that the term <span class="math notranslate nohighlight">\(a_{i+1}\)</span> depends on the position at <span class="math notranslate nohighlight">\(x_{i+1}\)</span>. This means that you need to calculate
the position at the updated time <span class="math notranslate nohighlight">\(t_{i+1}\)</span> before the computing the next velocity.  Note also that the derivative of the velocity at the time
<span class="math notranslate nohighlight">\(t_i\)</span> used in the updating of the position can be reused in the calculation of the velocity update as well.</p>
<p>We can now easily add the Verlet method to our original code as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using the Velocity-Verlet  method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up forces, air resistance FD, note now that we need the norm of the vecto</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using the Velocity-Verlet method</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">DeltaT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">DeltaT</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">anew</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunVV&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_222_0.png" src="_images/chapter4_222_0.png" />
</div>
</div>
<p>You can easily generalize the calculation of the forces by defining a function
which takes in as input the various variables. We leave this as a challenge to you.</p>
</div>
</div>
<div class="section" id="additional-material-link-between-line-integrals-and-conservative-forces">
<h2><span class="section-number">4.6. </span>Additional Material: Link between Line Integrals and Conservative forces<a class="headerlink" href="#additional-material-link-between-line-integrals-and-conservative-forces" title="Permalink to this headline">¶</a></h2>
<p>The concept of line integrals plays an important role in our discussion of energy conservation,
our definition of potentials and conservative forces.</p>
<p>Let us remind ourselves of some the basic elements (most of you may
have seen this in a calculus course under the general topic of vector
fields).</p>
<p>We define a path integration <span class="math notranslate nohighlight">\(C\)</span>, that is we integrate
from a point <span class="math notranslate nohighlight">\(\boldsymbol{r}_1\)</span> to a point <span class="math notranslate nohighlight">\(\boldsymbol{r}_2\)</span>.
Let us assume that the path <span class="math notranslate nohighlight">\(C\)</span> is represented by an arc length <span class="math notranslate nohighlight">\(s\)</span>. In three dimension we have the following representation of <span class="math notranslate nohighlight">\(C\)</span></p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{r}(s)=x(s)\boldsymbol{e}_1+y(s)\boldsymbol{e}_2+z(s)\boldsymbol{e}_3,
\]</div>
<p>then our integral of a function <span class="math notranslate nohighlight">\(f(x,y,z)\)</span> along the path <span class="math notranslate nohighlight">\(C\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
\int_Cf(x,y,z)ds=\int_a^bf\left(x(s),y(s),z(s)\right)ds,
\]</div>
<p>where the initial and final points are <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>, respectively.</p>
<p>With the definition of a line integral, we can in tunrn set up the
theorem of independence of integration path.</p>
<p>Let us define
<span class="math notranslate nohighlight">\(f(x,y,z)\)</span>, <span class="math notranslate nohighlight">\(g(x,y,z)\)</span> and <span class="math notranslate nohighlight">\(h(x,y,z)\)</span> to be functions which are
defined and continuous in a domain <span class="math notranslate nohighlight">\(D\)</span> in space. Then a line integral
like the above is said to be independent of path in <span class="math notranslate nohighlight">\(D\)</span>, if for every
pair of endpoints <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> in <span class="math notranslate nohighlight">\(D\)</span> the value of the integral is the
same for all paths <span class="math notranslate nohighlight">\(C\)</span> in <span class="math notranslate nohighlight">\(D\)</span> starting from a point <span class="math notranslate nohighlight">\(a\)</span> and ending in
a point <span class="math notranslate nohighlight">\(b\)</span>. The integral depends thus only on the integration limits
and not on the path.</p>
<p>An expression of the form</p>
<div class="math notranslate nohighlight">
\[
fdx+gdy+hdz,
\]</div>
<p>where <span class="math notranslate nohighlight">\(f\)</span>, <span class="math notranslate nohighlight">\(g\)</span> and <span class="math notranslate nohighlight">\(h\)</span> are functions defined in <span class="math notranslate nohighlight">\(D\)</span>, is a called a first-order differential form
in three variables.
The form is said to be exact if it is the differential</p>
<div class="math notranslate nohighlight">
\[
du= \frac{\partial u}{\partial x}dx+\frac{\partial u}{\partial y}dy+\frac{\partial u}{\partial z}dz,
\]</div>
<p>of a differentiable function <span class="math notranslate nohighlight">\(u(x,y,z)\)</span> everywhere in <span class="math notranslate nohighlight">\(D\)</span>, that is</p>
<div class="math notranslate nohighlight">
\[
du=fdx+gdy+hdz.
\]</div>
<p>It is said to be exact if and only if we can then set</p>
<div class="math notranslate nohighlight">
\[
f=\frac{\partial u}{\partial x},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
g=\frac{\partial u}{\partial y},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
h=\frac{\partial u}{\partial z},
\]</div>
<p>everywhere in the domain <span class="math notranslate nohighlight">\(D\)</span>.</p>
<p>In vector language the above means that the differential form</p>
<div class="math notranslate nohighlight">
\[
fdx+gdy+hdz,
\]</div>
<p>is exact in <span class="math notranslate nohighlight">\(D\)</span> if and only if the vector function (it could be a force, or velocity, acceleration or other vectors we encounter in this course)</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}=f\boldsymbol{e}_1+g\boldsymbol{e}_2+h\boldsymbol{e}_3,
\]</div>
<p>is the gradient of a function <span class="math notranslate nohighlight">\(u(x,y,z)\)</span></p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{v}=\boldsymbol{\nabla}u=\frac{\partial u}{\partial x}\boldsymbol{e}_1+\frac{\partial u}{\partial y}\boldsymbol{e}_2+\frac{\partial u}{\partial z}\boldsymbol{e}_3.
\]</div>
<p>If this is the case, we can state the path independence theorem which
states that with functions <span class="math notranslate nohighlight">\(f(x,y,z)\)</span>, <span class="math notranslate nohighlight">\(g(x,y,z)\)</span> and <span class="math notranslate nohighlight">\(h(x,y,z)\)</span> that fulfill the above
exactness conditions,  the line integral</p>
<div class="math notranslate nohighlight">
\[
\int_C\left(fdx+gdy+hdz\right),
\]</div>
<p>is independent of path in <span class="math notranslate nohighlight">\(D\)</span> if and only if the differential form under the integral sign is exact in <span class="math notranslate nohighlight">\(D\)</span>.</p>
<p>This is the path independence theorem.</p>
<p>We will not give a proof of the theorem. You can find this in any vector analysis chapter in a mathematics textbook.</p>
<p>We note however that the path integral from a point <span class="math notranslate nohighlight">\(p\)</span> to a final point <span class="math notranslate nohighlight">\(q\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[
\int_p^q\left(fdx+gdy+hdz\right)=\int_p^q\left(\frac{\partial u}{\partial x}dx+\frac{\partial u}{\partial y}dy+\frac{\partial u}{\partial z}dz\right)=\int_p^qdu.
\]</div>
<p>Assume now that we have a dependence on a variable <span class="math notranslate nohighlight">\(s\)</span> for <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span>. We have then</p>
<div class="math notranslate nohighlight">
\[
\int_p^qdu=\int_{s_1}^{s_2}\frac{du}{ds}ds = u(x(s),y(s),z(s))\vert_{s=s_1}^{s=s_2}=u(q)-u(p).
\]</div>
<p>This last equation</p>
<div class="math notranslate nohighlight">
\[
\int_p^q\left(fdx+gdy+hdz\right)=u(q)-u(p),
\]</div>
<p>is the analogue of the usual formula</p>
<div class="math notranslate nohighlight">
\[
\int_a^bf(x)dx=F(x)\vert_a^b=F(b)-F(a),
\]</div>
<p>with <span class="math notranslate nohighlight">\(F'(x)=f(x)\)</span>.</p>
<p>We remember that a the work done by a force
<span class="math notranslate nohighlight">\(\boldsymbol{F}=f\boldsymbol{e}_1+g\boldsymbol{e}_2+h\boldsymbol{e}_3\)</span> on a displacemnt <span class="math notranslate nohighlight">\(d\boldsymbol{r}\)</span>
is</p>
<div class="math notranslate nohighlight">
\[
W=\int_C\boldsymbol{F}d\boldsymbol{r}=\int_C(fdx+gdy+hdz).
\]</div>
<p>From the path independence theorem, we know that this has to result in
the difference between the two endpoints only. This is exact if and
only if the force is the force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> is the gradient of a scalar
function <span class="math notranslate nohighlight">\(u\)</span>. We call this scalar function, which depends only the
positions <span class="math notranslate nohighlight">\(x,y,z\)</span> for the potential energy <span class="math notranslate nohighlight">\(V(x,y,z)=V(\boldsymbol{r})\)</span>.</p>
<p>We have thus</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(\boldsymbol{r})\propto \boldsymbol{\nabla}V(\boldsymbol{r}),
\]</div>
<p>and we define  this as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(\boldsymbol{r})= -\boldsymbol{\nabla}V(\boldsymbol{r}).
\]</div>
<p>Such a force is called <strong>a conservative force</strong>. The above expression can be used to demonstrate
energy conservation.</p>
<p>Finally we can define the criterion for exactness and independence of
path. This theorem states that if <span class="math notranslate nohighlight">\(f(x,y,z)\)</span>, <span class="math notranslate nohighlight">\(g(x,y,z)\)</span> and
<span class="math notranslate nohighlight">\(h(x,y,z)\)</span> are continuous functions with continuous first partial derivatives in the domain <span class="math notranslate nohighlight">\(D\)</span>,
then the line integral</p>
<div class="math notranslate nohighlight">
\[
\int_C\left(fdx+gdy+hdz\right),
\]</div>
<p>is independent of path in <span class="math notranslate nohighlight">\(D\)</span> when</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial h}{\partial y}=\frac{\partial g}{\partial z},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial f}{\partial z}=\frac{\partial h}{\partial x},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial g}{\partial x}=\frac{\partial f}{\partial y}.
\]</div>
<p>This leads to the <strong>curl</strong> of <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> being zero</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\nabla}\times\boldsymbol{F}=\boldsymbol{\nabla}\times\left(-\boldsymbol{\nabla}V(\boldsymbol{r})\right)=0!
\]</div>
<p>A conservative force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> is a defined as the partial derivative of a scalar potential which depends only on the position,</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(\boldsymbol{r})= -\boldsymbol{\nabla}V(\boldsymbol{r}).
\]</div>
<p>This leads to conservation of energy and a path independent line integral as long as the curl of the force is zero, that is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\nabla}\times\boldsymbol{F}=\boldsymbol{\nabla}\times\left(-\boldsymbol{\nabla}V(\boldsymbol{r})\right)=0.
\]</div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">4.7. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exercise-conservation-laws-energy-and-momentum">
<h3><span class="section-number">4.7.1. </span>Exercise: Conservation laws, Energy and momentum<a class="headerlink" href="#exercise-conservation-laws-energy-and-momentum" title="Permalink to this headline">¶</a></h3>
<p>How do we define a conservative force?</p>
<p>A conservative force is a force whose property is that the total work
done in moving an object between two points is independent of the
taken path. This means that the work on an object under the influence
of a conservative force, is independent on the path of the object. It
depends only on the spatial degrees of freedom and it is possible to
assign a numerical value for the potential at any point. It leads to
conservation of energy. The gravitational force is an example of a
conservative force.</p>
<p>If you wish to read more about conservative forces or not, Feyman’s lectures from 1963 are quite interesting.
He states for example that <strong>All fundamental forces in nature appear to be conservative</strong>.
This statement was made while developing his argument that <em>there are no nonconservative forces</em>.
You may enjoy the link to <a class="reference external" href="http://www.feynmanlectures.caltech.edu/I_14.html">Feynman’s lecture</a>.</p>
<p>An important condition for the final work to be independent of the path is that the <strong>curl</strong> of the force is zero, that
is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\nabla} \times \boldsymbol{F}=0
\]</div>
<p>Use the work-energy theorem to show that energy is conserved with a conservative force.
The work-energy theorem states that the work done <span class="math notranslate nohighlight">\(W\)</span> by a force <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> that moves an object from a position <span class="math notranslate nohighlight">\(\boldsymbol{r}_0\)</span> to a new position <span class="math notranslate nohighlight">\(\boldsymbol{r}_1\)</span></p>
<div class="math notranslate nohighlight">
\[
W=\int_{\boldsymbol{r}_0}^{\boldsymbol{r}_1}\boldsymbol{F}\boldsymbol{dr}=\frac{1}{2}mv_1^2-\frac{1}{2}mv_0^2,
\]</div>
<p>where <span class="math notranslate nohighlight">\(v_1^2\)</span> is the velocity squared at a time <span class="math notranslate nohighlight">\(t_1\)</span> and <span class="math notranslate nohighlight">\(v_0^2\)</span> the corresponding quantity at a time <span class="math notranslate nohighlight">\(t_0\)</span>.
The work done is thus the difference in kinetic energies. We can rewrite the above equation as</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2}mv_1^2=\int_{\boldsymbol{r}_0}^{\boldsymbol{r}_1}\boldsymbol{F}\boldsymbol{dr}+\frac{1}{2}mv_0^2,
\]</div>
<p>that is the final kinetic energy is equal to the initial kinetic energy plus the work done by the force over a given path from a  position <span class="math notranslate nohighlight">\(\boldsymbol{r}_0\)</span> at time <span class="math notranslate nohighlight">\(t_0\)</span> to a final position position <span class="math notranslate nohighlight">\(\boldsymbol{r}_1\)</span> at a later time <span class="math notranslate nohighlight">\(t_1\)</span>.</p>
<p>Assume that you have only internal two-body forces acting on <span class="math notranslate nohighlight">\(N\)</span> objects in an isolated system. The force from object <span class="math notranslate nohighlight">\(i\)</span> on object <span class="math notranslate nohighlight">\(j\)</span> is <span class="math notranslate nohighlight">\(\boldsymbol{f}_{ij}\)</span>. Show that the linear momentum is conserved.</p>
<p>Here we use Newton’s third law and assume that our system is only
affected by so-called internal forces.  This means that the force
<span class="math notranslate nohighlight">\(\boldsymbol{f}_{ij}\)</span> from object <span class="math notranslate nohighlight">\(i\)</span> acting on object <span class="math notranslate nohighlight">\(j\)</span> is equal to the
force acting on object <span class="math notranslate nohighlight">\(j\)</span> from object <span class="math notranslate nohighlight">\(i\)</span> but with opposite sign,
that is <span class="math notranslate nohighlight">\(\boldsymbol{f}_{ij}=-\boldsymbol{f}_{ji}\)</span>.</p>
<p>The total linear momentum is defined as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{P}=\sum_{i=1}^N\boldsymbol{p}_i=\sum_{i=1}^Nm_i\boldsymbol{v}_i,
\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> runs over all objects, <span class="math notranslate nohighlight">\(m_i\)</span> is the mass of object <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{v}_i\)</span> its corresponding velocity.</p>
<p>The force acting on object <span class="math notranslate nohighlight">\(i\)</span> from all the other objects is (lower
case letters for individual objects and upper case letters for total
quantities)</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{f}_i=\sum_{j=1}^N\boldsymbol{f}_{ji}.
\]</div>
<p>Summing over all objects the net force is</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^N\boldsymbol{f}_i=\sum_{i=1}^N\sum_{j=1;j\ne i}^N\boldsymbol{f}_{ji}.
\]</div>
<p>We are summing freely over all objects with the constraint that <span class="math notranslate nohighlight">\(i\ne j\)</span> (no self-interactions).
We can now manipulate the double sum as</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^N\sum_{j=1;j\ne i}^N\boldsymbol{f}_{ji}=\sum_{i=1}^N\sum_{j&gt;i}^N(\boldsymbol{f}_{ji}+\boldsymbol{f}_{ij}).
\]</div>
<p>Convince yourself about this by setting <span class="math notranslate nohighlight">\(N=2\)</span> and <span class="math notranslate nohighlight">\(N=3\)</span>. Nweton’s third law says
<span class="math notranslate nohighlight">\(\boldsymbol{f}_{ij}=-\boldsymbol{f}_{ji}\)</span>, which means we have</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^N\sum_{j=1;j\ne i}^N\boldsymbol{f}_{ji}=\sum_{i=1}^N\sum_{j&gt;i}^N(\boldsymbol{f}_{ji}-\boldsymbol{f}_{ji})=0.
\]</div>
<p>The total force due to internal degrees of freedom only is thus <span class="math notranslate nohighlight">\(0\)</span>.
If we then use the definition that</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^N\boldsymbol{f}_i=\sum_{i=1}^Nm_i\frac{d\boldsymbol{v}_i}{dt}=\sum_{i=1}^N\frac{d\boldsymbol{p}_i}{dt}=\frac{d \boldsymbol{P}}{dt}=0,
\]</div>
<p>where we assumed that <span class="math notranslate nohighlight">\(m_i\)</span> is independent of time, we see that time derivative of the total momentum is zero.
We say then that the linear momentum is a constant of the motion. It is conserved.</p>
</div>
<div class="section" id="exercise-conservation-of-angular-momentum">
<h3><span class="section-number">4.7.2. </span>Exercise: Conservation of angular momentum<a class="headerlink" href="#exercise-conservation-of-angular-momentum" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Define angular momentum and the torque for a single object with external forces only.</p></li>
</ul>
<p>The angular moment <span class="math notranslate nohighlight">\(\boldsymbol{l}_i\)</span> for a given object <span class="math notranslate nohighlight">\(i\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{l}_i = \boldsymbol{r}_i \times \boldsymbol{p}_i,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{p}_i=m_i\boldsymbol{v}_i\)</span>. With external forces only defining the acceleration and the mass being time independent, the momentum is the integral over the external force as function of time, that is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{p}_i(t)=\boldsymbol{p}_i(t_0)+\int_{t_0}^t \boldsymbol{f}_i^{\mathrm{ext}}(t')dt'.
\]</div>
<p>The torque for one object is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}_i=\frac{d\boldsymbol{l}_i}{dt} = \frac{dt(\boldsymbol{r}_i \times \boldsymbol{p}_i)}{dt}=\boldsymbol{r}_i \times \frac{d\boldsymbol{p}_i}{dt}=\boldsymbol{r}_i \times \boldsymbol{f}_i,
\]</div>
<ul class="simple">
<li><p>Define angular momentum and the torque for a system with <span class="math notranslate nohighlight">\(N\)</span> objects/particles  with external and internal forces. The force from object <span class="math notranslate nohighlight">\(i\)</span> on object <span class="math notranslate nohighlight">\(j\)</span> is <span class="math notranslate nohighlight">\(\boldsymbol{F}_{ij}\)</span>.</p></li>
</ul>
<p>The total angular momentum <span class="math notranslate nohighlight">\(\boldsymbol{L}\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{L}=\sum_{i=1}^N\boldsymbol{l}_i = \sum_{i=1}^N\boldsymbol{r}_i \times \boldsymbol{p}_i.
\]</div>
<p>and the total torque is (using the expression for one object from 2a)</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}=\sum_{i=1}^N\frac{d\boldsymbol{l}_i}{dt} = \sum_{i=1}^N\boldsymbol{r}_i \times \boldsymbol{f}_i.
\]</div>
<p>The force acting on one object is <span class="math notranslate nohighlight">\(\boldsymbol{f}_i=\boldsymbol{f}_i^{\mathrm{ext}}+\sum_{j=1}^N\boldsymbol{f}_{ji}\)</span>.</p>
<ul class="simple">
<li><p>With internal forces only, what is the mathematical form of the forces that allows for angular momentum to be conserved?</p></li>
</ul>
<p>Using the results from 1c, we can rewrite without external forces our torque as</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}=\sum_{i=1}^N\frac{\boldsymbol{l}_i}{dt} = \sum_{i=1}^N\boldsymbol{r}_i \times \boldsymbol{f}_i=\sum_{i=1}^N(\boldsymbol{r}_i \times \sum_{j=1}^N\boldsymbol{f}_{ji}),
\]</div>
<p>which gives</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}=\sum_{i=1}^N\sum_{j=1;j\ne i}^N(\boldsymbol{r}_i \times \boldsymbol{f}_{ji}).
\]</div>
<p>We can rewrite this as (convince yourself again about this)</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}=\sum_{i=1}^N\sum_{j&gt;i}^N(\boldsymbol{r}_i \times \boldsymbol{f}_{ji}+\boldsymbol{r}_j \times \boldsymbol{f}_{ij}),
\]</div>
<p>and using Newton’s third law we have</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\tau}=\sum_{i=1}^N\sum_{j&gt;i}^N(\boldsymbol{r}_i -\boldsymbol{r}_j) \times \boldsymbol{f}_{ji}.
\]</div>
<p>If the force is proportional to <span class="math notranslate nohighlight">\(\boldsymbol{r}_i -\boldsymbol{r}_j\)</span> then angular momentum is conserved since the cross-product of a vector with itself is zero. We say thus that angular momentum is a constant of the motion.</p>
</div>
<div class="section" id="exsercise-example-of-potential">
<h3><span class="section-number">4.7.3. </span>Exsercise: Example of potential<a class="headerlink" href="#exsercise-example-of-potential" title="Permalink to this headline">¶</a></h3>
<p>Consider a particle of mass <span class="math notranslate nohighlight">\(m\)</span> moving according to the potential</p>
<div class="math notranslate nohighlight">
\[
V(x,y,z)=A\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}.
\]</div>
<ul class="simple">
<li><p>Is energy conserved? If so, why?</p></li>
</ul>
<p>In this exercise <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(a\)</span> are constants. The force is given by the derivative of <span class="math notranslate nohighlight">\(V\)</span> with respect to the spatial degrees of freedom and since the potential depends only on position, the force is conservative and energy is conserved. Furthermore, the curl of the force is zero. To see this we need first to compute the derivatives of the potential with respect to <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span>.
We have that</p>
<div class="math notranslate nohighlight">
\[
F_x = -\frac{\partial V}{\partial x}=-\frac{xA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_y = 0,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_z = -\frac{\partial V}{\partial z}=-\frac{zA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}.
\]</div>
<p>The components of the <strong>curl</strong> of <span class="math notranslate nohighlight">\(\boldsymbol{F}\)</span> are</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{\nabla}\times\boldsymbol{F})_x = \frac{\partial F_y}{\partial z}-\frac{\partial F_z}{\partial y}=0,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{\nabla}\times\boldsymbol{F})_y = \frac{\partial F_x}{\partial z}-\frac{\partial F_z}{\partial x}=\frac{xzA}{a^4}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}-\frac{xzA}{a^4}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}=0,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{\nabla}\times\boldsymbol{F})_z = \frac{\partial F_y}{\partial x}-\frac{\partial F_x}{\partial y}=0.
\]</div>
<p>The force is a conservative one.</p>
<ul class="simple">
<li><p>Which of  the quantities, <span class="math notranslate nohighlight">\(p_x,p_y,p_z\)</span> are conserved?</p></li>
</ul>
<p>Taking the derivatives with respect to time shows that only <span class="math notranslate nohighlight">\(p_y\)</span> is conserved
We see this directly from the above expressions for the force, since the derivative with respect to time of the momentum is simply the force. Thus, only the <span class="math notranslate nohighlight">\(y\)</span>-component of the momentum is conserved, see the expressions above for the forces,</p>
<p>For the next exercise, we also need the following derivatives</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial F_x}{\partial x} = \frac{x^2A}{a^4}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}-\frac{A}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial F_y}{\partial y} = 0,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial F_z}{\partial z} = \frac{z^2A}{a^4}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}-\frac{A}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\},
\]</div>
<ul class="simple">
<li><p>Which of  the quantities, <span class="math notranslate nohighlight">\(L_x,L_y,L_z\)</span> are conserved?</p></li>
</ul>
<p>Using that <span class="math notranslate nohighlight">\(\boldsymbol{L}=\boldsymbol{r}\times\boldsymbol{p}\)</span> and that</p>
<div class="math notranslate nohighlight">
\[
\frac{d\boldsymbol{L}}{dt}=\boldsymbol{r}\times\boldsymbol{F},
\]</div>
<p>we have that the different components are</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{r}\times\boldsymbol{F})_x = zF_y-yF_z=\frac{yzA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}.
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{r}\times\boldsymbol{F})_y = xF_z-zF_x=-\frac{xzA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}+\frac{xzA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}=0,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
(\boldsymbol{r}\times\boldsymbol{F})_z = xF_y-yF_x=\frac{yxA}{a^2}\exp\left\{-\frac{x^2+z^2}{2a^2}\right\}.
\]</div>
<p>Only <span class="math notranslate nohighlight">\(L_y\)</span> is conserved.</p>
</div>
<div class="section" id="exercise-forces-and-potentials">
<h3><span class="section-number">4.7.4. </span>Exercise: forces  and potentials<a class="headerlink" href="#exercise-forces-and-potentials" title="Permalink to this headline">¶</a></h3>
<p>A particle of mass <span class="math notranslate nohighlight">\(m\)</span> has velocity <span class="math notranslate nohighlight">\(v=\alpha/x\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> is its displacement.</p>
<ul class="simple">
<li><p>Find the force <span class="math notranslate nohighlight">\(F(x)\)</span> responsible for the motion.</p></li>
</ul>
<p>Here, since the force is assumed to be conservative (only dependence on <span class="math notranslate nohighlight">\(x\)</span>), we can use energy conservation.
Assuming that the total energy at <span class="math notranslate nohighlight">\(t=0\)</span> is <span class="math notranslate nohighlight">\(E_0\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
E_0=V(x)+\frac{1}{2}mv^2=V(x)+\frac{1}{2}m\frac{\alpha^2}{x^2}.
\]</div>
<p>Taking the derivative wrt <span class="math notranslate nohighlight">\(x\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
\frac{dV}{dx}-m\frac{\alpha^2}{x^3}=0,
\]</div>
<p>and since <span class="math notranslate nohighlight">\(F(x)=-dV/dx\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
F(x)=-m\frac{\alpha^2}{x^3}.
\]</div>
<p>A particle is thereafter under the influence of a force <span class="math notranslate nohighlight">\(F=-kx+kx^3/\alpha^2\)</span>, where <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(\alpha\)</span> are constants and <span class="math notranslate nohighlight">\(k\)</span> is positive.</p>
<ul class="simple">
<li><p>Determine <span class="math notranslate nohighlight">\(V(x)\)</span>  and discuss the motion. It can be convenient here to make a sketch/plot of the potential as function of <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
</ul>
<p>We assume that the potential is zero at say <span class="math notranslate nohighlight">\(x=0\)</span>. Integrating the force from zero to <span class="math notranslate nohighlight">\(x\)</span> gives</p>
<div class="math notranslate nohighlight">
\[
V(x) = -\int_0^x F(x')dx'=\frac{kx^2}{2}-\frac{kx^4}{4\alpha^2}.
\]</div>
<p>The following code plots the potential. We have chosen values of <span class="math notranslate nohighlight">\(\alpha=k=1.0\)</span>. Feel free to experiment with other values. We plot <span class="math notranslate nohighlight">\(V(x)\)</span> for a domain of <span class="math notranslate nohighlight">\(x\in [-2,2]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">x0</span><span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
<span class="n">xn</span> <span class="o">=</span> <span class="mf">2.1</span>
<span class="n">Deltax</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1">#set up arrays</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">xn</span><span class="p">,</span><span class="n">Deltax</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_348_0.png" src="_images/chapter4_348_0.png" />
</div>
</div>
<p>From the plot here (with the chosen parameters)</p>
<ol class="simple">
<li><p>we see that with a given initial velocity we can overcome the potential energy barrier</p></li>
</ol>
<p>and leave the potential well for good.</p>
<ol class="simple">
<li><p>If the initial velocity is smaller (see next exercise) than a certain value, it will remain trapped in the potential well and oscillate back and forth around <span class="math notranslate nohighlight">\(x=0\)</span>. This is where the potential has its minimum value.</p></li>
<li><p>If the kinetic energy at <span class="math notranslate nohighlight">\(x=0\)</span> equals the maximum potential energy, the object will oscillate back and forth between the minimum potential energy at <span class="math notranslate nohighlight">\(x=0\)</span> and the turning points where the kinetic energy turns zero. These are the so-called non-equilibrium points.</p></li>
</ol>
<ul class="simple">
<li><p>What happens when the energy of the particle is <span class="math notranslate nohighlight">\(E=(1/4)k\alpha^2\)</span>? Hint: what is the maximum value of the potential energy?</p></li>
</ul>
<p>From the figure we see that
the potential has a minimum at at <span class="math notranslate nohighlight">\(x=0\)</span> then rises until <span class="math notranslate nohighlight">\(x=\alpha\)</span> before falling off again. The maximum
potential, <span class="math notranslate nohighlight">\(V(x\pm \alpha) = k\alpha^2/4\)</span>. If the energy is higher, the particle cannot be contained in the
well. The turning points are thus defined by <span class="math notranslate nohighlight">\(x=\pm \alpha\)</span>. And from the previous plot you can easily see that this is the case (<span class="math notranslate nohighlight">\(\alpha=1\)</span> in the abovementioned Python code).</p>
</div>
<div class="section" id="exercise-work-energy-theorem-and-conservation-laws">
<h3><span class="section-number">4.7.5. </span>Exercise: Work-energy theorem and conservation laws<a class="headerlink" href="#exercise-work-energy-theorem-and-conservation-laws" title="Permalink to this headline">¶</a></h3>
<p>This exercise was partly discussed above.
We will study a classical electron which moves in the <span class="math notranslate nohighlight">\(x\)</span>-direction along a surface. The force from the surface is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}(x)=-F_0\sin{(\frac{2\pi x}{b})}\boldsymbol{e}_x.
\]</div>
<p>The constant <span class="math notranslate nohighlight">\(b\)</span> represents the distance between atoms at the surface of the material, <span class="math notranslate nohighlight">\(F_0\)</span> is a constant and <span class="math notranslate nohighlight">\(x\)</span> is the position of the electron.</p>
<ul class="simple">
<li><p>Is this a conservative force? And if so, what does that imply?</p></li>
</ul>
<p>This is indeed a conservative force since it depends only on position and its <strong>curl</strong> is zero. This means that energy is conserved and the integral over the work done by the force is independent of the path taken.</p>
<ul class="simple">
<li><p>Use the work-energy theorem to find the velocity <span class="math notranslate nohighlight">\(v(x)\)</span>.</p></li>
</ul>
<p>Using the work-energy theorem we can find the work <span class="math notranslate nohighlight">\(W\)</span> done when moving an electron from a position <span class="math notranslate nohighlight">\(x_\
0\)</span> to a final position <span class="math notranslate nohighlight">\(x\)</span> through the integral</p>
<div class="math notranslate nohighlight">
\[
W=\int_{x_0}^x \boldsymbol{F}(x')dx' =  -\int_{x_0}^x F_0\sin{(\frac{2\pi x'}{b})} dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
W=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right].
\]</div>
<p>Since this is related to the change in kinetic energy we have, with <span class="math notranslate nohighlight">\(v_0\)</span> being the initial velocity at a  time <span class="math notranslate nohighlight">\(t_0\)</span>,</p>
<div class="math notranslate nohighlight">
\[
v  = \pm\sqrt{\frac{2}{m}\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right]+v_0^2}.
\]</div>
<ul class="simple">
<li><p>With the above expression for the force, find the potential energy.</p></li>
</ul>
<p>The potential energy, due to energy conservation is</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)+\frac{1}{2}mv_0^2-\frac{1}{2}mv^2,
\]</div>
<p>with <span class="math notranslate nohighlight">\(v\)</span> given by the previous answer.
We can now, in order to find a more explicit expression for the potential energy at a given value <span class="math notranslate nohighlight">\(x\)</span>, define a zero level value for the potential. The potential is defined , using the work-energy theorem , as</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)+\int_{x_0}^x (-F(x'))dx',
\]</div>
<p>and if you recall the definition of the indefinite integral, we can rewrite this as</p>
<div class="math notranslate nohighlight">
\[
V(x)=\int (-F(x'))dx'+C,
\]</div>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is an undefined constant. The force is defined as the gradient of the potential, and in that case the undefined constant vanishes. The constant does not affect the force we derive from the potential.</p>
<p>We have then</p>
<div class="math notranslate nohighlight">
\[
V(x)=V(x_0)-\int_{x_0}^x \boldsymbol{F}(x')dx',
\]</div>
<p>which results in</p>
<div class="math notranslate nohighlight">
\[
V(x)=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}-\cos{(\frac{2\pi x_0}{b})}\right]+V(x_0).
\]</div>
<p>We can now define</p>
<div class="math notranslate nohighlight">
\[
\frac{F_0b}{2\pi}\cos{(\frac{2\pi x_0}{b})}=V(x_0),
\]</div>
<p>which gives</p>
<div class="math notranslate nohighlight">
\[
V(x)=\frac{F_0b}{2\pi}\left[\cos{(\frac{2\pi x}{b})}\right].
\]</div>
<ul class="simple">
<li><p>Make a plot of the potential energy and discuss the equilibrium points where the force on the electron is zero. Discuss the physical interpretation of stable and unstable equilibrium points. Use energy conservation.</p></li>
</ul>
<p>The following Python code plots the potential</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">Deltax</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays</span>
<span class="n">xinitial</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
<span class="n">xfinal</span> <span class="o">=</span> <span class="mf">2.0</span> 
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">xfinal</span><span class="o">-</span><span class="n">xinitial</span><span class="p">)</span><span class="o">/</span><span class="n">Deltax</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xinitial</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">Deltax</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># Setting values for the constants. </span>
<span class="n">F0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> 
<span class="c1"># Defining the potential</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">F0</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_372_0.png" src="_images/chapter4_372_0.png" />
</div>
</div>
<p>We have stable equilibrium  points for every minimum of the <span class="math notranslate nohighlight">\(\cos\)</span> function and unstable equilibrium points where it has its maximimum values. At the minimum the particle has the lowest potential energy and the largest kinetic energy whereas at the maxima it has the largest potential energy and lowest kinetic energy.</p>
</div>
<div class="section" id="exsercise-rocket-momentum-and-mass">
<h3><span class="section-number">4.7.6. </span>Exsercise: Rocket, Momentum and mass<a class="headerlink" href="#exsercise-rocket-momentum-and-mass" title="Permalink to this headline">¶</a></h3>
<p>Taylor exercise 3.11.</p>
<p>Consider the rocket of mass <span class="math notranslate nohighlight">\(M\)</span> moving with velocity <span class="math notranslate nohighlight">\(v\)</span>. After a
brief instant, the velocity of the rocket is <span class="math notranslate nohighlight">\(v+\Delta v\)</span> and the mass
is <span class="math notranslate nohighlight">\(M-\Delta M\)</span>. Momentum conservation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray*}
Mv&amp;=&amp;(M-\Delta M)(v+\Delta v)+\Delta M(v-v_e)\\
0&amp;=&amp;-\Delta Mv+M\Delta v+\Delta M(v-v_e),\\
0&amp;=&amp;M\Delta v-\Delta Mv_e.
\end{eqnarray*}
\end{split}\]</div>
<p>In the second step we ignored the term <span class="math notranslate nohighlight">\(\Delta M\Delta v\)</span> since we
assume it is small. The last equation gives</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\Delta v&amp;=&amp;\frac{v_e}{M}\Delta M,\\
\nonumber
\frac{dv}{dt}&amp;=&amp;\frac{v_e}{M}\frac{dM}{dt}.
\end{eqnarray}
\end{split}\]</div>
<p>Here we let <span class="math notranslate nohighlight">\(\Delta v\rightarrow dv\)</span> and <span class="math notranslate nohighlight">\(\Delta M\rightarrow dM\)</span>.
We have also assumed that <span class="math notranslate nohighlight">\(M(t) = M_0-kt\)</span>.
Integrating the expression with lower limits <span class="math notranslate nohighlight">\(v_0=0\)</span> and <span class="math notranslate nohighlight">\(M_0\)</span>, one finds</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray*}
v&amp;=&amp;v_e\int_{M_0}^M \frac{dM'}{M'}\\
v&amp;=&amp;v_e\ln(M/M_0)\\
&amp;=&amp;v_e\ln[(M_0-k t)/M_0].
\end{eqnarray*}
\end{split}\]</div>
<p>We have ignored gravity here. If we add gravity as the external force, we get when integrating an additional terms <span class="math notranslate nohighlight">\(-gt\)</span>, that is</p>
<div class="math notranslate nohighlight">
\[
v=v_e\ln[(M_0-k t)/M_0]-gt.
\]</div>
<p>Inserting numbers <span class="math notranslate nohighlight">\(v_e=3000\)</span> m/s, <span class="math notranslate nohighlight">\(M_0/M=2\)</span> and <span class="math notranslate nohighlight">\(g=9.8\)</span> m/s<span class="math notranslate nohighlight">\(^{2}\)</span>, we find <span class="math notranslate nohighlight">\(v=900\)</span> m/s. With <span class="math notranslate nohighlight">\(g=0\)</span> the corresponding number is <span class="math notranslate nohighlight">\(2100\)</span> m/s, so gravity reduces the speed acquired in the first two minutes to a little less than half its weight-free value.</p>
<p>If the thrust <span class="math notranslate nohighlight">\(\Delta Mv_e\)</span> is less than the weight <span class="math notranslate nohighlight">\(mg\)</span>, the rocket will just sit on the ground until it has shed enough mass that the thrust can overcome the weight, definitely not a good design.</p>
</div>
<div class="section" id="exercise-more-rockets">
<h3><span class="section-number">4.7.7. </span>Exercise: More Rockets<a class="headerlink" href="#exercise-more-rockets" title="Permalink to this headline">¶</a></h3>
<p>This is a continuation of the previous exercise and most of the relevant background material can be found in Taylor chapter 3.2.</p>
<p>Taking the velocity from the previous exercise and integrating over time we find the height</p>
<div class="math notranslate nohighlight">
\[
y(t) = y(t_0=0)+\int_0^tv(t')dt',
\]</div>
<p>which gives</p>
<div class="math notranslate nohighlight">
\[
y(t) = v_et\ln{M_0}-v_e\int_0^t \ln{M(t')}dt'-\frac{1}{2}gt^2.
\]</div>
<p>To do the integral over time we recall that <span class="math notranslate nohighlight">\(M(t')=M_0-\Delta M t'\)</span>. We assumed that <span class="math notranslate nohighlight">\(\Delta M=k\)</span> is a constant.
We use that <span class="math notranslate nohighlight">\(M_0-M=kt\)</span> and assume that mass decreases by a constant <span class="math notranslate nohighlight">\(k\)</span> times time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>We obtain then that the integral gives</p>
<div class="math notranslate nohighlight">
\[
\int_0^t \ln{M(t')}dt' = \int_0^t \ln{(M_0-kt')}dt',
\]</div>
<p>and defining the variable <span class="math notranslate nohighlight">\(u=M_0-kt'\)</span>, with <span class="math notranslate nohighlight">\(du=-kdt'\)</span> and the new limits <span class="math notranslate nohighlight">\(M_0\)</span> when <span class="math notranslate nohighlight">\(t=0\)</span> and <span class="math notranslate nohighlight">\(M_0-kt\)</span> when time is equal to <span class="math notranslate nohighlight">\(t\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
\int_0^t \ln{M(t')}dt' = \int_0^t \ln{(M_0-kt')}dt'=-\frac{1}{k}\int_{M_0}^{M_0-kt} \ln{(u)}du=-\frac{1}{k}\left[u\ln{(u)}-u\right]_{M_0}^{M_0-kt},
\]</div>
<p>and writing out we obtain</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{k}\left[u\ln{(u)}-u\right]_{M_0}^{M_0-kt} = \frac{1}{k}\left(M_0\ln{M_0}-M\ln{M}\right)-t,
\]</div>
<p>Mulitplying with <span class="math notranslate nohighlight">\(-v_e\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
-\frac{v_e}{k}\left(M_0\ln{M_0}-M\ln{M}\right)+v_et,
\]</div>
<p>which we can rewrite as, using <span class="math notranslate nohighlight">\(M_0=M+kt\)</span>,</p>
<div class="math notranslate nohighlight">
\[
-\frac{v_e}{k}\left((M+kt)\ln{M_0}-M\ln{M}\right)+v_et=v_et-v_et\ln{M_0}-\frac{Mv_e}{k}\ln{(\frac{M_0}{M})}.
\]</div>
<p>Inserting into <span class="math notranslate nohighlight">\(y(t)\)</span> we obtain then</p>
<div class="math notranslate nohighlight">
\[
y(t) = v_et-\frac{1}{2}gt^2-\frac{Mv_e}{k}\ln{(\frac{M_0}{M})}.
\]</div>
<p>Using the numbers from the previous exercise with <span class="math notranslate nohighlight">\(t=2\)</span> min we obtain that <span class="math notranslate nohighlight">\(y\approx 40\)</span> km.</p>
<p>For exercise 3.14 (5pt) we have the equation of motion which reads <span class="math notranslate nohighlight">\(Ma=kv_e-bv\)</span> or</p>
<div class="math notranslate nohighlight">
\[
\frac{Mdv}{kv_e-bv}=dt.
\]</div>
<p>We have that <span class="math notranslate nohighlight">\(dM/dt =-k\)</span> (assumed a constant rate for mass change). We can then replace <span class="math notranslate nohighlight">\(dt\)</span> by <span class="math notranslate nohighlight">\(-dM/k\)</span> and we have</p>
<div class="math notranslate nohighlight">
\[
\frac{kdv}{kv_e-bv}=-\frac{dM}{M}.
\]</div>
<p>Integrating gives</p>
<div class="math notranslate nohighlight">
\[
v = \frac{kv_e}{b}\left[1-(\frac{M}{M_0})^{b/k}\right].
\]</div>
</div>
<div class="section" id="exercise-center-of-mass">
<h3><span class="section-number">4.7.8. </span>Exercise: Center of mass<a class="headerlink" href="#exercise-center-of-mass" title="Permalink to this headline">¶</a></h3>
<p>Taylor exercise 3.20. Here Taylor’s chapter 3.3 can be of use. This relation will turn out to be very useful when we discuss systems of many classical particles.</p>
<p>The definition of the center of mass for <span class="math notranslate nohighlight">\(N\)</span> objects can be written as</p>
<div class="math notranslate nohighlight">
\[
M\boldsymbol{R}=\sum_{i=1}^Nm_i\boldsymbol{r}_i,
\]</div>
<p>where <span class="math notranslate nohighlight">\(m_i\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{r}_i\)</span> are the masses and positions of object <span class="math notranslate nohighlight">\(i\)</span>, respectively.</p>
<p>Assume now that we have a collection of <span class="math notranslate nohighlight">\(N_1\)</span> objects with masses <span class="math notranslate nohighlight">\(m_{1i}\)</span> and positions <span class="math notranslate nohighlight">\(\boldsymbol{r}_{1i}\)</span>
with <span class="math notranslate nohighlight">\(i=1,\dots,N_1\)</span> and  a collection of <span class="math notranslate nohighlight">\(N_2\)</span> objects with masses <span class="math notranslate nohighlight">\(m_{2j}\)</span> and positions <span class="math notranslate nohighlight">\(\boldsymbol{r}_{2j}\)</span>
with <span class="math notranslate nohighlight">\(j=1,\dots,N_2\)</span>.</p>
<p>The total mass of the two-body system is <span class="math notranslate nohighlight">\(M=M_1+M_2=\sum_{i=1}^{N_1}m_{1i}+\sum_{j=1}^{N_2}m_{2j}\)</span>. The center of mass position <span class="math notranslate nohighlight">\(\boldsymbol{R}\)</span> of the whole system satisfies then</p>
<div class="math notranslate nohighlight">
\[
M\boldsymbol{R}=\sum_{i=1}^{N_1}m_{1i}\boldsymbol{r}_{1i}+\sum_{j=1}^{N_2}m_{2j}\boldsymbol{r}_{2j}=M_1\boldsymbol{R}_1+M_2\boldsymbol{R}_2,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{R}_1\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{R}_2\)</span> are the the center of mass positions of the two separate bodies and the second equality follows from our rewritten definition of the center of mass applied to each body separately. This is the required result.</p>
</div>
<div class="section" id="exercise-the-earth-sun-problem">
<h3><span class="section-number">4.7.9. </span>Exercise: The Earth-Sun problem<a class="headerlink" href="#exercise-the-earth-sun-problem" title="Permalink to this headline">¶</a></h3>
<p>We start with the Earth-Sun system  in two dimensions only.  The gravitational force <span class="math notranslate nohighlight">\(F_G\)</span> on the earth from the sun is</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}_G=-\frac{GM_{\odot}M_E}{r^3}\boldsymbol{r},
\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the gravitational constant,</p>
<div class="math notranslate nohighlight">
\[
M_E=6\times 10^{24}\mathrm{Kg},
\]</div>
<p>the mass of Earth,</p>
<div class="math notranslate nohighlight">
\[
M_{\odot}=2\times 10^{30}\mathrm{Kg},
\]</div>
<p>the mass of the Sun and</p>
<div class="math notranslate nohighlight">
\[
r=1.5\times 10^{11}\mathrm{m},
\]</div>
<p>is the distance between Earth and the Sun. The latter defines what we call an astronomical unit <strong>AU</strong>.
From Newton’s second law we have then for the <span class="math notranslate nohighlight">\(x\)</span> direction</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2x}{dt^2}=-\frac{F_{x}}{M_E},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2y}{dt^2}=-\frac{F_{y}}{M_E},
\]</div>
<p>for the <span class="math notranslate nohighlight">\(y\)</span> direction.</p>
<p>Here we will use  that  <span class="math notranslate nohighlight">\(x=r\cos{(\theta)}\)</span>, <span class="math notranslate nohighlight">\(y=r\sin{(\theta)}\)</span> and</p>
<div class="math notranslate nohighlight">
\[
r = \sqrt{x^2+y^2}.
\]</div>
<p>We can rewrite these equations</p>
<div class="math notranslate nohighlight">
\[
F_{x}=-\frac{GM_{\odot}M_E}{r^2}\cos{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_{y}=-\frac{GM_{\odot}M_E}{r^2}\sin{(\theta)}=-\frac{GM_{\odot}M_E}{r^3}y,
\]</div>
<p>as four first-order coupled differential equations</p>
<div class="math notranslate nohighlight">
\[
\frac{dv_x}{dt}=-\frac{GM_{\odot}}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dx}{dt}=v_x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dv_y}{dt}=-\frac{GM_{\odot}}{r^3}y,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y.
\]</div>
<p>The four coupled differential equations</p>
<div class="math notranslate nohighlight">
\[
\frac{dv_x}{dt}=-\frac{GM_{\odot}}{r^3}x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dx}{dt}=v_x,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dv_y}{dt}=-\frac{GM_{\odot}}{r^3}y,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\frac{dy}{dt}=v_y,
\]</div>
<p>can be turned into dimensionless equations or we can introduce astronomical units with <span class="math notranslate nohighlight">\(1\)</span> AU = <span class="math notranslate nohighlight">\(1.5\times 10^{11}\)</span>.</p>
<p>Using the equations from circular motion (with <span class="math notranslate nohighlight">\(r =1\mathrm{AU}\)</span>)</p>
<div class="math notranslate nohighlight">
\[
\frac{M_E v^2}{r} = F = \frac{GM_{\odot}M_E}{r^2},
\]</div>
<p>we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}=v^2r,
\]</div>
<p>and using that the velocity of Earth (assuming circular motion) is
<span class="math notranslate nohighlight">\(v = 2\pi r/\mathrm{yr}=2\pi\mathrm{AU}/\mathrm{yr}\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
GM_{\odot}= v^2r = 4\pi^2 \frac{(\mathrm{AU})^3}{\mathrm{yr}^2}.
\]</div>
<p>The four coupled differential equations can then be discretized using Euler’s method as (with step length <span class="math notranslate nohighlight">\(h\)</span>)</p>
<div class="math notranslate nohighlight">
\[
v_{x,i+1}=v_{x,i}-h\frac{4\pi^2}{r_i^3}x_i,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
x_{i+1}=x_i+hv_{x,i},
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
v_{y,i+1}=v_{y,i}-h\frac{4\pi^2}{r_i^3}y_i,
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
y_{i+1}=y_i+hv_{y,i},
\]</div>
<p>The code here implements Euler’s method for the Earth-Sun system using a more compact way of representing the vectors. Alternatively, you could have spelled out all the variables <span class="math notranslate nohighlight">\(v_x\)</span>, <span class="math notranslate nohighlight">\(v_y\)</span>, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> as one-dimensional arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Where to save the figures and data files</span>
<span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;Results&quot;</span>
<span class="n">FIGURE_ID</span> <span class="o">=</span> <span class="s2">&quot;Results/FigureFiles&quot;</span>
<span class="n">DATA_ID</span> <span class="o">=</span> <span class="s2">&quot;DataFiles/&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="n">dat_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">,</span> <span class="n">dat_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>


<span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using Euler&#39;s method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up the acceleration</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using Euler&#39;s forward method</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">a</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.set_xlim(0, tfinal)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunEuler&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_456_0.png" src="_images/chapter4_456_0.png" />
</div>
</div>
<p>We notice here that Euler’s method doesn’t give a stable orbit with for example <span class="math notranslate nohighlight">\(\Delta t =0.01\)</span>. It
means that we cannot trust Euler’s method. Euler’s method does not conserve energy. It is an
example of an integrator which is not
<a class="reference external" href="https://en.wikipedia.org/wiki/Symplectic_integrator">symplectic</a>.</p>
<p>Here we present thus two methods, which with simple changes allow us
to avoid these pitfalls. The simplest possible extension is the
so-called Euler-Cromer method.  The changes we need to make to our
code are indeed marginal here.  We need simply to replace</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>in the above code with the velocity at the new time <span class="math notranslate nohighlight">\(t_{i+1}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>By this simple caveat we get stable orbits.  Below we derive the
Euler-Cromer method as well as one of the most utlized algorithms for
solving the above type of problems, the so-called Velocity-Verlet
method.</p>
<p>Let us repeat Euler’s method.
We have a differential equation</p>
<!-- Equation labels as ordinary links -->
<div id="_auto7"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
  y'(t_i)=f(t_i,y_i)   
\label{_auto7} \tag{14}
\end{equation}
\]</div>
<p>and if we truncate at the first derivative, we have from the Taylor expansion</p>
<div class="math notranslate nohighlight">
\[
y_{i+1}=y(t_i) + (\Delta t) f(t_i,y_i) + O(\Delta t^2),
\]</div>
<p>which when complemented with <span class="math notranslate nohighlight">\(t_{i+1}=t_i+\Delta t\)</span> forms
the algorithm for the well-known Euler method.
Note that at every step we make an approximation error
of the order of <span class="math notranslate nohighlight">\(O(\Delta t^2)\)</span>, however the total error is the sum over all
steps <span class="math notranslate nohighlight">\(N=(b-a)/(\Delta t)\)</span> for <span class="math notranslate nohighlight">\(t\in [a,b]\)</span>, yielding thus a global error which goes like
<span class="math notranslate nohighlight">\(NO(\Delta t^2)\approx O(\Delta t)\)</span>.</p>
<p>To make Euler’s method more precise we can obviously
decrease <span class="math notranslate nohighlight">\(\Delta t\)</span> (increase <span class="math notranslate nohighlight">\(N\)</span>), but this can lead to loss of numerical precision.
Euler’s method is not recommended for precision calculation,
although it is handy to use in order to get a first
view on how a solution may look like.</p>
<p>Euler’s method is asymmetric in time, since it uses information about the derivative at the beginning
of the time interval. This means that we evaluate the position at <span class="math notranslate nohighlight">\(y_1\)</span> using the velocity
at <span class="math notranslate nohighlight">\(v_0\)</span>. A simple variation is to determine <span class="math notranslate nohighlight">\(x_{n+1}\)</span> using the velocity at
<span class="math notranslate nohighlight">\(v_{n+1}\)</span>, that is (in a slightly more generalized form)</p>
<!-- Equation labels as ordinary links -->
<div id="_auto8"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation} 
   y_{n+1}=y_{n}+ v_{n+1}+O(\Delta t^2)
\label{_auto8} \tag{15}
\end{equation}
\]</div>
<p>and</p>
<!-- Equation labels as ordinary links -->
<div id="_auto9"></div>
<div class="math notranslate nohighlight">
\[
\begin{equation}
   v_{n+1}=v_{n}+(\Delta t) a_{n}+O(\Delta t^2).
\label{_auto9} \tag{16}
\end{equation}
\]</div>
<p>The acceleration <span class="math notranslate nohighlight">\(a_n\)</span> is a function of <span class="math notranslate nohighlight">\(a_n(y_n, v_n, t_n)\)</span> and needs to be evaluated
as well. This is the Euler-Cromer method. It is easy to change the above code and see that with the same
time step we get stable results.</p>
<p>Let us stay with <span class="math notranslate nohighlight">\(x\)</span> (position) and <span class="math notranslate nohighlight">\(v\)</span> (velocity) as the quantities we are interested in.</p>
<p>We have the Taylor expansion for the position given by</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_i+O((\Delta t)^3).
\]</div>
<p>The corresponding expansion for the velocity is</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+(\Delta t)a_i+\frac{(\Delta t)^2}{2}v^{(2)}_i+O((\Delta t)^3).
\]</div>
<p>Via Newton’s second law we have normally an analytical expression for the derivative of the velocity, namely</p>
<div class="math notranslate nohighlight">
\[
a_i= \frac{d^2 x}{dt^2}\vert_{i}=\frac{d v}{dt}\vert_{i}= \frac{F(x_i,v_i,t_i)}{m}.
\]</div>
<p>If we add to this the corresponding expansion for the derivative of the velocity</p>
<div class="math notranslate nohighlight">
\[
v^{(1)}_{i+1} = a_{i+1}= a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2)=a_i+(\Delta t)v^{(2)}_i+O((\Delta t)^2),
\]</div>
<p>and retain only terms up to the second derivative of the velocity since our error goes as <span class="math notranslate nohighlight">\(O(h^3)\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[
(\Delta t)v^{(2)}_i\approx a_{i+1}-a_i.
\]</div>
<p>We can then rewrite the Taylor expansion for the velocity as</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left( a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Our final equations for the position and the velocity become then</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_{i}+O((\Delta t)^3),
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left(a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Note well that the term <span class="math notranslate nohighlight">\(a_{i+1}\)</span> depends on the position at <span class="math notranslate nohighlight">\(x_{i+1}\)</span>. This means that you need to calculate
the position at the updated time <span class="math notranslate nohighlight">\(t_{i+1}\)</span> before the computing the next velocity.  Note also that the derivative of the velocity at the time
<span class="math notranslate nohighlight">\(t_i\)</span> used in the updating of the position can be reused in the calculation of the velocity update as well.</p>
<p>We can now easily add the Verlet method to our original code as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using the Velocity-Verlet  method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up forces, air resistance FD, note now that we need the norm of the vecto</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using the Velocity-Verlet method</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">DeltaT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">DeltaT</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">anew</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunVV&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_486_0.png" src="_images/chapter4_486_0.png" />
</div>
</div>
<p>You can easily generalize the calculation of the forces by defining a function
which takes in as input the various variables. We leave this as a challenge to you.</p>
<p>Running the above code for various time steps we see that the Velocity-Verlet is fully stable for various time steps.</p>
<p>We can also play around with different initial conditions in order to find the escape velocity from an orbit around the sun with distance one astronomical unit, 1 AU. The theoretical value for the escape velocity, is given by</p>
<div class="math notranslate nohighlight">
\[
v = \sqrt{8\pi^2}{r},
\]</div>
<p>and with <span class="math notranslate nohighlight">\(r=1\)</span> AU, this means that the escape velocity is <span class="math notranslate nohighlight">\(2\pi\sqrt{2}\)</span> AU/yr. To obtain this we required that the kinetic energy of Earth equals the potential energy given by the gravitational force.</p>
<p>Setting</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2}M_{\mathrm{Earth}}v^2=\frac{GM_{\odot}}{r},
\]</div>
<p>and with <span class="math notranslate nohighlight">\(GM_{\odot}=4\pi^2\)</span> we obtain the above relation for the velocity. Setting an initial velocity say equal to <span class="math notranslate nohighlight">\(9\)</span> in the above code, yields a planet (Earth) which escapes a stable orbit around the sun, as seen by running the code here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="c1"># setting initial velocity larger than escape velocity</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">9.0</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Start integrating using the Velocity-Verlet  method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up forces, air resistance FD, note now that we need the norm of the vecto</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using the Velocity-Verlet method</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">DeltaT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">DeltaT</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">anew</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y[AU]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EscapeEarthSunVV&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_492_0.png" src="_images/chapter4_492_0.png" />
</div>
</div>
</div>
<div class="section" id="exercise-conservative-forces">
<h3><span class="section-number">4.7.10. </span>Exercise Conservative forces<a class="headerlink" href="#exercise-conservative-forces" title="Permalink to this headline">¶</a></h3>
<p>Which of the following force are conservative?  All three forces depend only on <span class="math notranslate nohighlight">\(\boldsymbol{r}\)</span> and satisfy the first condition for being conservative.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{F}=k(x\boldsymbol{i}+2y\boldsymbol{j}+3z\boldsymbol{k})\)</span> where <span class="math notranslate nohighlight">\(k\)</span> is a constant.</p></li>
</ul>
<p>The <strong>curl</strong> is zero and the force is conservative.  The potential energy is upon integration <span class="math notranslate nohighlight">\(V(x)=-k(1/2x^2+y^2+3/2z^2)\)</span>. Taking the derivative shows that this is indeed the case since it gives back the force.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{F}=y\boldsymbol{i}+x\boldsymbol{j}+0\boldsymbol{k}\)</span>.</p></li>
</ul>
<p>This force is also conservative since it depends only on the coordinates and its curl is zero. To find the potential energy, since the integral is path independent, we can choose to integrate along any direction. The simplest is start from <span class="math notranslate nohighlight">\(x=0\)</span> as origin and follow a path along the <span class="math notranslate nohighlight">\(x\)</span>-axis (which gives zero) and then parallel to the <span class="math notranslate nohighlight">\(y\)</span>-axis, which results in <span class="math notranslate nohighlight">\(V(x,y) = -xy\)</span>. Taking the derivative with respect to <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> gives us back the expression for the force.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{F}=k(-y\boldsymbol{i}+x\boldsymbol{j}+0\boldsymbol{k})\)</span> where <span class="math notranslate nohighlight">\(k\)</span> is a constant.</p></li>
</ul>
<p>Here the <strong>curl</strong> is <span class="math notranslate nohighlight">\((0,0,2)\)</span> and the force is not conservative.</p>
<ul class="simple">
<li><p>2d For those which are conservative, find the corresponding potential energy <span class="math notranslate nohighlight">\(V\)</span> and verify that direct differentiation that <span class="math notranslate nohighlight">\(\boldsymbol{F}=-\boldsymbol{\nabla} V\)</span>.</p></li>
</ul>
<p>See the answers to each exercise above.</p>
</div>
<div class="section" id="exercise-the-lennard-jones-potential">
<h3><span class="section-number">4.7.11. </span>Exercise: The Lennard-Jones potential<a class="headerlink" href="#exercise-the-lennard-jones-potential" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Lennard-Jones_potential">The Lennard-Jones potential</a> is often used to describe
the interaction between two atoms or ions or molecules. If you end up doing materals science and molecular dynamics calculations, it is very likely that you will encounter this potential model.
The expression for the potential energy is</p>
<div class="math notranslate nohighlight">
\[
V(r) = V_0\left((\frac{a}{r})^{12}-(\frac{b}{r})^{6}\right),
\]</div>
<p>where <span class="math notranslate nohighlight">\(V_0\)</span>, <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are constants and the potential depends only on the relative distance between two objects
<span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, that is <span class="math notranslate nohighlight">\(r=\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert=\sqrt{(x_i-x_j)^2+(y_i-y_j)^2+(z_i-z_j)^2}\)</span>.</p>
<ul class="simple">
<li><p>Sketch/plot the potential (choose some values for the constants in doing so).</p></li>
</ul>
<p>The following Python code plots the potential</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Deltar</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays</span>
<span class="n">rinitial</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">rfinal</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">rfinal</span><span class="o">-</span><span class="n">rinitial</span><span class="p">)</span><span class="o">/</span><span class="n">Deltar</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rinitial</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">Deltar</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">V0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">V0</span><span class="o">*</span><span class="p">((</span><span class="n">a</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.set_xlim(0, tfinal)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_496_0.png" src="_images/chapter4_496_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Find and classify the equilibrium points.</p></li>
</ul>
<p>Here there is  only one equilibrium point when we take the derivative of the potential with respect to the relative distance.</p>
<p>The derivative with respect to <span class="math notranslate nohighlight">\(r\)</span>, the relative distance, is</p>
<div class="math notranslate nohighlight">
\[
\frac{dV}{dr} = -6V_0\left(2\frac{a^{12}}{r^{13}}-\frac{b^6}{r^7}\right),
\]</div>
<p>and this is zero when</p>
<div class="math notranslate nohighlight">
\[
r = 2^{1/6}\frac{a^2}{b}.
\]</div>
<p>If we choose <span class="math notranslate nohighlight">\(a=2\)</span> and <span class="math notranslate nohighlight">\(b=2\)</span> then <span class="math notranslate nohighlight">\(r=2\times 2^{1/6}\)</span>. Since the second derivative is positive for all <span class="math notranslate nohighlight">\(r\)</span> for our choices of <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>  (convince yourself about  this), then this value of <span class="math notranslate nohighlight">\(r\)</span> has to correspond to a minimum of the potential. This agrees with our graph from the figure above (run the code to produce the figure).</p>
<ul class="simple">
<li><p>What is the force acting on one of the objects (an atom for example) from the other object? Is this a conservative force?</p></li>
</ul>
<p>From the previous exercise we have</p>
<div class="math notranslate nohighlight">
\[
\frac{dV}{dr} = -6V_0\left(2\frac{a^{12}}{r^{13}}-\frac{b^6}{r^7}\right).
\]</div>
<p>We need the gradient and since the force on particle <span class="math notranslate nohighlight">\(i\)</span> is given by <span class="math notranslate nohighlight">\(\boldsymbol{F}_i=\boldsymbol{\nabla}_i V(\boldsymbol{r}_i-\boldsymbol{r}_j)\)</span>, we obtain</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{F}_i=6V_0\left(2(\frac{a}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert})^{12}-(\frac{b}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert})^6\right)\frac{\boldsymbol{r}_i-\boldsymbol{r}_j}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert^2}.
\]</div>
<p>Here <span class="math notranslate nohighlight">\(r = \vert\vert \boldsymbol{r}_i-\boldsymbol{r}_j\vert \vert\)</span>.
If we have more than two particles, we need to sum over all other particles <span class="math notranslate nohighlight">\(j\)</span>. We have thus to introduce a sum over all particles <span class="math notranslate nohighlight">\(N\)</span>.
The force on particle <span class="math notranslate nohighlight">\(i\)</span> at position <span class="math notranslate nohighlight">\(\boldsymbol{r}_i\)</span> from all particles  <span class="math notranslate nohighlight">\(j\)</span> at their positions <span class="math notranslate nohighlight">\(\boldsymbol{r}_j\)</span> results in the equation of motion (note that we have divided by the mass <span class="math notranslate nohighlight">\(m\)</span> here)</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{a}_i=\frac{d^2\boldsymbol{r}_i}{dt^2} = \frac{6V_0}{m} \sum_{j \neq i}^{N}\left(2(\frac{a}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert})^{12}-(\frac{b}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert})^6\right)\frac{\boldsymbol{r}_i-\boldsymbol{r}_j}{\vert\vert\boldsymbol{r}_i-\boldsymbol{r}_j\vert\vert^2}.
\]</div>
<p>This is also a conservative force, with zero <strong>curl</strong> as well.</p>
</div>
<div class="section" id="exercise-particle-in-a-new-potential">
<h3><span class="section-number">4.7.12. </span>Exercise: particle in a new potential<a class="headerlink" href="#exercise-particle-in-a-new-potential" title="Permalink to this headline">¶</a></h3>
<p>Consider a particle of mass <span class="math notranslate nohighlight">\(m\)</span> moving in a one-dimensional potential,</p>
<div class="math notranslate nohighlight">
\[
V(x)=-\alpha\frac{x^2}{2}+\beta\frac{x^4}{4}.
\]</div>
<ul class="simple">
<li><p>Plot the potential and discuss eventual equilibrium points. Is this a conservative force?</p></li>
</ul>
<p>The following Python code gives a plot of potential</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Deltax</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#set up arrays</span>
<span class="n">xinitial</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
<span class="n">xfinal</span> <span class="o">=</span> <span class="mf">2.0</span> 
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">xfinal</span><span class="o">-</span><span class="n">xinitial</span><span class="p">)</span><span class="o">/</span><span class="n">Deltax</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xinitial</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">Deltax</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.81</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="n">beta</span><span class="p">))</span>
<span class="n">V</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
<span class="c1"># Plot position as function of time    </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#ax.set_xlim(0, tfinal)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V[s]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2727922061357855
</pre></div>
</div>
<img alt="_images/chapter4_510_1.png" src="_images/chapter4_510_1.png" />
</div>
</div>
<p>Here we have chosen <span class="math notranslate nohighlight">\(\alpha=0.81\)</span> and <span class="math notranslate nohighlight">\(\beta=0.5\)</span>. Taking the derivative of <span class="math notranslate nohighlight">\(V\)</span> with respect to <span class="math notranslate nohighlight">\(x\)</span> gives two minima (and it is easy to see here that the second derivative is positive) at <span class="math notranslate nohighlight">\(x\pm\sqrt{\alpha/\beta}\)</span> and a maximum at <span class="math notranslate nohighlight">\(x=0\)</span>. The derivative is</p>
<div class="math notranslate nohighlight">
\[
\frac{dV}{dx} = -\alpha x + \beta x^3,
\]</div>
<p>which gives when we require that it should equal zero the above values. As we can see from the plot (run the above Python code), we have two so-called stable equilibrium points (where the potential has its minima) and an unstable equilibrium point.</p>
<p>The force is conservative since it depends only on <span class="math notranslate nohighlight">\(x\)</span> and has a <strong>curl</strong> which is zero.</p>
<ul class="simple">
<li><p>Compute the second derivative of the potential and find its miminum position(s). Using the Taylor expansion of the potential around its minimum (see Taylor section 5.1) to define a spring constant <span class="math notranslate nohighlight">\(k\)</span>. Use the spring constant to find the natural (angular) frequency <span class="math notranslate nohighlight">\(\omega_0=\sqrt{k/m}\)</span>. We call the new spring constant for  an effective spring constant.</p></li>
</ul>
<p>In the solution to the previous exercise we listed the values where the derivatives of the potential are zero.
Taking the second derivatives we have that</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2V}{dx^2} = -\alpha  + 3\beta x^2,
\]</div>
<p>and for <span class="math notranslate nohighlight">\(\alpha,\beta &gt; 0\)</span> (we assume they are positive constants) we see that when <span class="math notranslate nohighlight">\(x=0\)</span> that the
the second derivative is negative, which means this is a maximum. For <span class="math notranslate nohighlight">\(x=\pm\sqrt{\alpha/\beta}\)</span> we see that the second derivative is positive. Thus these points correspond to two minima.</p>
<p>Assume now we Taylor-expand the potential around one of these minima, say <span class="math notranslate nohighlight">\(x_{\mathrm{min}}=\sqrt{\alpha/\beta}\)</span>. We have thus</p>
<div class="math notranslate nohighlight">
\[
V(x) = V(x_{\mathrm{min}})+(x-x_{\mathrm{min}})\frac{dV}{dx}\vert_{x_{\mathrm{min}}}+\frac{1}{2}(x-x_{\mathrm{min}})^2\frac{d^2V}{dx^2}\vert_{x_{\mathrm{min}}}+\dots
\]</div>
<p>Since we are at point where the first derivative is zero and inserting the value for the second derivative of <span class="math notranslate nohighlight">\(V\)</span>, keeping only terms up to the second derivative and finally taking the derivative with respect to <span class="math notranslate nohighlight">\(x\)</span>, we find the expression for the force</p>
<div class="math notranslate nohighlight">
\[
F(x) = -(x-x_{\mathrm{min}})\frac{d^2V}{dx^2}\vert_{x_{\mathrm{min}}},
\]</div>
<p>and setting in the expression for the second derivative at the minimum we find</p>
<div class="math notranslate nohighlight">
\[
F(x) = -2\alpha(x-\sqrt{\frac{\alpha}{\beta}}).
\]</div>
<p>Thus our effective spring constant <span class="math notranslate nohighlight">\(k=2\alpha\)</span>.</p>
<ul class="simple">
<li><p>We ignore the second term in the potential energy and keep only the term proportional to the effective spring constant, that is a force <span class="math notranslate nohighlight">\(F\propto kx\)</span>. Find the acceleration and set up the differential equation.  Find the general analytical solution for these harmonic oscillations.  You don’t need to find the constants in the general solution.</p></li>
</ul>
<p>Here we simplify our force by rescaling our zeroth point so that we have a force (setting <span class="math notranslate nohighlight">\(x_{\mathrm{min}}=0\)</span>)</p>
<div class="math notranslate nohighlight">
\[
F(x) = -kx,
\]</div>
<p>with <span class="math notranslate nohighlight">\(k=2\alpha\)</span>. Defining a natural frequency <span class="math notranslate nohighlight">\(\omega_0 = \sqrt{k/m}\)</span>, where <span class="math notranslate nohighlight">\(m\)</span> is the mass of our particle, we have the following equation of motion</p>
<div class="math notranslate nohighlight">
\[
\frac{d^2x}{dt^2}=-\omega_0^2x,
\]</div>
<p>which has as analytical solution <span class="math notranslate nohighlight">\(x(t)=A\cos{(\omega_0t)}+B\sin{(\omega_0t)}\)</span> and velocity
<span class="math notranslate nohighlight">\(x(t)=-\omega_0A\sin{(\omega_0t)}+\omega_0B\cos{(\omega_0t)}\)</span>. The initial conditions are used to define <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>.</p>
</div>
<div class="section" id="exercise-testing-energy-conservation">
<h3><span class="section-number">4.7.13. </span>Exercise: Testing Energy conservation<a class="headerlink" href="#exercise-testing-energy-conservation" title="Permalink to this headline">¶</a></h3>
<p>The code here implements Euler’s method for the Earth-Sun system using
a more compact way of representing the vectors. Alternatively, you
could have spelled out all the variables <span class="math notranslate nohighlight">\(v_x\)</span>, <span class="math notranslate nohighlight">\(v_y\)</span>, <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> as
one-dimensional arrays.  It tests conservation of potential and
kinetic energy as functions of time, in addition to the total energy,
again as function of time</p>
<p><strong>Note</strong>: in all codes we have used scaled equations so that the gravitational constant times the mass of the sum is given by <span class="math notranslate nohighlight">\(4\pi^2\)</span> and the mass of the earth is set to <strong>one</strong> in the calculations of kinetic and potential energies. Else, we would get very large results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Where to save the figures and data files</span>
<span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;Results&quot;</span>
<span class="n">FIGURE_ID</span> <span class="o">=</span> <span class="s2">&quot;Results/FigureFiles&quot;</span>
<span class="n">DATA_ID</span> <span class="o">=</span> <span class="s2">&quot;DataFiles/&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="n">dat_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">,</span> <span class="n">dat_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

<span class="c1"># Initial values, time step, positions and velocites</span>

<span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># setting up the kinetic, potential and total energy, note only functions of time</span>
<span class="n">EKinetic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">EPotential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">ETotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>


<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Setting up variables for the calculation of energies</span>
<span class="c1">#  distance that defines rabs in potential energy</span>
<span class="n">rabs0</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="c1">#  Initial kinetic energy. Note that we skip the mass of the Earth here, that is MassEarth=1 in all codes</span>
<span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v0</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span>
<span class="c1">#  Initial potential energy  (note negative sign, why?)</span>
<span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">rabs0</span>
<span class="c1">#  Initial total energy </span>
<span class="n">ETotal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Start integrating using Euler&#39;s method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up the acceleration</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update Energies, velocity, time and position using Euler&#39;s forward method</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">a</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
    <span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ETotal</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Plot energies as functions of time    </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EKinetic</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Kinetic energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EPotential</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Potential Energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ETotal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [yr]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunEuler&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_526_0.png" src="_images/chapter4_526_0.png" />
</div>
</div>
<p>We see very clearly that Euler’s method does not conserve energy!! Try to reduce the time step <span class="math notranslate nohighlight">\(\Delta t\)</span>. What do you see?</p>
<p>With the Euler-Cromer method, the only thing we need is to update the
position at a time <span class="math notranslate nohighlight">\(t+1\)</span> with the update velocity from the same
time. Thus, the change in the code is extremely simply, and <strong>energy is
suddenly conserved</strong>. Note that the error runs like <span class="math notranslate nohighlight">\(O(\Delta t)\)</span> and
this is why we see the larger oscillations. But within this
oscillating energy envelope, we see that the energies swing between a
max and a min value and never exceed these values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Where to save the figures and data files</span>
<span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;Results&quot;</span>
<span class="n">FIGURE_ID</span> <span class="o">=</span> <span class="s2">&quot;Results/FigureFiles&quot;</span>
<span class="n">DATA_ID</span> <span class="o">=</span> <span class="s2">&quot;DataFiles/&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FIGURE_ID</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="n">dat_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_ID</span><span class="p">,</span> <span class="n">dat_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

<span class="c1"># Initial values, time step, positions and velocites</span>

<span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># in years</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># setting up the kinetic, potential and total energy, note only functions of time</span>
<span class="n">EKinetic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">EPotential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">ETotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>


<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="c1"># Setting up variables for the calculation of energies</span>
<span class="c1">#  distance that defines rabs in potential energy</span>
<span class="n">rabs0</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="c1">#  Initial kinetic energy. Note that we skip the mass of the Earth here, that is MassEarth=1 in all codes</span>
<span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v0</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span>
<span class="c1">#  Initial potential energy </span>
<span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">rabs0</span>
<span class="c1">#  Initial total energy </span>
<span class="n">ETotal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Start integrating using Euler&#39;s method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up the acceleration</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using Euler&#39;s forward method</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">a</span>
<span class="c1">#   Only change when we add the Euler-Cromer method    </span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
    <span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ETotal</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Plot energies as functions of time    </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EKinetic</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Kinetic energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EPotential</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Potential Energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ETotal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [yr]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunEulerCromer&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_528_0.png" src="_images/chapter4_528_0.png" />
</div>
</div>
<p>Our final equations for the position and the velocity become then</p>
<div class="math notranslate nohighlight">
\[
x_{i+1} = x_i+(\Delta t)v_i+\frac{(\Delta t)^2}{2}a_{i}+O((\Delta t)^3),
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
v_{i+1} = v_i+\frac{(\Delta t)}{2}\left(a_{i+1}+a_{i}\right)+O((\Delta t)^3).
\]</div>
<p>Note well that the term <span class="math notranslate nohighlight">\(a_{i+1}\)</span> depends on the position at <span class="math notranslate nohighlight">\(x_{i+1}\)</span>. This means that you need to calculate
the position at the updated time <span class="math notranslate nohighlight">\(t_{i+1}\)</span> before the computing the next velocity.  Note also that the derivative of the velocity at the time
<span class="math notranslate nohighlight">\(t_i\)</span> used in the updating of the position can be reused in the calculation of the velocity update as well.</p>
<p>We can now easily add the Verlet method to our original code as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaT</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="c1">#set up arrays </span>
<span class="n">tfinal</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">tfinal</span><span class="o">/</span><span class="n">DeltaT</span><span class="p">)</span>
<span class="c1"># set up arrays for t, a, v, and x</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># Initial conditions as compact 2-dimensional arrays</span>
<span class="n">r0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">Fourpi2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>

<span class="c1"># setting up the kinetic, potential and total energy, note only functions of time</span>
<span class="n">EKinetic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">EPotential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">ETotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Setting up variables for the calculation of energies</span>
<span class="c1">#  distance that defines rabs in potential energy</span>
<span class="n">rabs0</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="c1">#  Initial kinetic energy. Note that we skip the mass of the Earth here, that is MassEarth=1 in all codes</span>
<span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v0</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span>
<span class="c1">#  Initial potential energy </span>
<span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">rabs0</span>
<span class="c1">#  Initial total energy </span>
<span class="n">ETotal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Start integrating using the Velocity-Verlet  method</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Set up forces, air resistance FD, note now that we need the norm of the vecto</span>
    <span class="c1"># Here you could have defined your own function for this</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="o">-</span><span class="n">Fourpi2</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># update velocity, time and position using the Velocity-Verlet method</span>
    <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">DeltaT</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">rabs</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">rabs</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">DeltaT</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">anew</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">DeltaT</span>
    <span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ETotal</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPotential</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">EKinetic</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Plot energies as functions of time    </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EKinetic</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tfinal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Kinetic energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">EPotential</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Potential Energy&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ETotal</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [yr]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total Energy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s2">&quot;EarthSunVelocityVerlet&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chapter4_534_0.png" src="_images/chapter4_534_0.png" />
</div>
</div>
<p>And we see that due to the smaller truncation error that energy conservation is improved as a function of time.
Try out different time steps <span class="math notranslate nohighlight">\(\Delta t\)</span> and see if the results improve or worsen.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="chapter3.html" title="previous page"><span class="section-number">3. </span>Simple Motion problems and Reminder on Newton’s Laws</a>
    <a class='right-next' id="next-link" href="chapter5.html" title="next page"><span class="section-number">1. </span>Harmonic Oscillations</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Morten Hjorth-Jensen and Scott Pratt<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>